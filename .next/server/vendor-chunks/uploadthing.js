"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "vendor-chunks/uploadthing";
exports.ids = ["vendor-chunks/uploadthing"];
exports.modules = {

/***/ "(ssr)/./node_modules/uploadthing/client/index.js":
/*!**************************************************!*\
  !*** ./node_modules/uploadthing/client/index.js ***!
  \**************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   UploadAbortedError: () => (/* reexport safe */ _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadAbortedError),\n/* harmony export */   UploadPausedError: () => (/* reexport safe */ _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadPausedError),\n/* harmony export */   genUploader: () => (/* binding */ genUploader),\n/* harmony export */   generateClientDropzoneAccept: () => (/* reexport safe */ _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.generateClientDropzoneAccept),\n/* harmony export */   generateMimeTypes: () => (/* reexport safe */ _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.generateMimeTypes),\n/* harmony export */   generatePermittedFileTypes: () => (/* reexport safe */ _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.generatePermittedFileTypes),\n/* harmony export */   isValidFileSize: () => (/* binding */ isValidFileSize),\n/* harmony export */   isValidFileType: () => (/* binding */ isValidFileType),\n/* harmony export */   version: () => (/* binding */ version)\n/* harmony export */ });\n/* harmony import */ var effect_Micro__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! effect/Micro */ \"(ssr)/./node_modules/effect/dist/esm/Micro.js\");\n/* harmony import */ var _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @uploadthing/shared */ \"(ssr)/./node_modules/@uploadthing/shared/dist/index.js\");\n/* harmony import */ var effect_Function__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! effect/Function */ \"(ssr)/./node_modules/effect/dist/esm/Function.js\");\n\n\n\n\n\nvar version$1 = \"7.0.2\";\n\nconst createDeferred = ()=>{\n    let resolve;\n    let reject;\n    const ac = new AbortController();\n    const promise = new Promise((res, rej)=>{\n        resolve = res;\n        reject = rej;\n    });\n    return {\n        promise,\n        ac,\n        resolve,\n        reject\n    };\n};\n\nconst createAPIRequestUrl = (config)=>{\n    const url = new URL(config.url);\n    const queryParams = new URLSearchParams(url.search);\n    queryParams.set(\"actionType\", config.actionType);\n    queryParams.set(\"slug\", config.slug);\n    url.search = queryParams.toString();\n    return url;\n};\n/**\n * Creates a \"client\" for reporting events to the UploadThing server via the user's API endpoint.\n * Events are handled in \"./handler.ts starting at L112\"\n */ const createUTReporter = (cfg)=>(type, payload)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.gen(function*() {\n            const url = createAPIRequestUrl({\n                url: cfg.url,\n                slug: cfg.endpoint,\n                actionType: type\n            });\n            const headers = new Headers((yield* effect_Micro__WEBPACK_IMPORTED_MODULE_1__.promise(async ()=>typeof cfg.headers === \"function\" ? await cfg.headers() : cfg.headers)));\n            headers.set(\"x-uploadthing-package\", cfg.package);\n            headers.set(\"x-uploadthing-version\", version$1);\n            headers.set(\"Content-Type\", \"application/json\");\n            const response = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.fetchEff)(url, {\n                method: \"POST\",\n                body: JSON.stringify(payload),\n                headers\n            }).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.andThen(_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.parseResponseJson), /**\n         * We don't _need_ to validate the response here, just cast it for now.\n         * As of now, @effect/schema includes quite a few bytes we cut out by this...\n         * We have \"strong typing\" on the backend that ensures the shape should match.\n         */ effect_Micro__WEBPACK_IMPORTED_MODULE_1__.map(effect_Function__WEBPACK_IMPORTED_MODULE_2__.unsafeCoerce), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.catchTag(\"FetchError\", (e)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.fail(new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                    code: \"INTERNAL_CLIENT_ERROR\",\n                    message: `Failed to report event \"${type}\" to UploadThing server`,\n                    cause: e\n                }))), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.catchTag(\"BadRequestError\", (e)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.fail(new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                    code: (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.getErrorTypeFromStatusCode)(e.status),\n                    message: e.getMessage(),\n                    cause: e.json\n                }))), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.catchTag(\"InvalidJson\", (e)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.fail(new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                    code: \"INTERNAL_CLIENT_ERROR\",\n                    message: \"Failed to parse response from UploadThing server\",\n                    cause: e\n                }))));\n            return response;\n        });\n\nconst uploadWithProgress = (file, rangeStart, presigned, onUploadProgress)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.async((resume)=>{\n        const xhr = new XMLHttpRequest();\n        xhr.open(\"PUT\", presigned.url, true);\n        xhr.setRequestHeader(\"Range\", `bytes=${rangeStart}-`);\n        xhr.responseType = \"json\";\n        let previousLoaded = 0;\n        xhr.upload.addEventListener(\"progress\", ({ loaded })=>{\n            const delta = loaded - previousLoaded;\n            onUploadProgress?.({\n                loaded,\n                delta\n            });\n            previousLoaded = loaded;\n        });\n        xhr.addEventListener(\"load\", ()=>{\n            resume(xhr.status >= 200 && xhr.status < 300 ? effect_Micro__WEBPACK_IMPORTED_MODULE_1__.succeed(xhr.response) : effect_Micro__WEBPACK_IMPORTED_MODULE_1__.die(`XHR failed ${xhr.status} ${xhr.statusText} - ${JSON.stringify(xhr.response)}`));\n        });\n        // Is there a case when the client would throw and\n        // ingest server not knowing about it? idts?\n        xhr.addEventListener(\"error\", ()=>{\n            resume(new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                code: \"UPLOAD_FAILED\"\n            }));\n        });\n        const formData = new FormData();\n        formData.append(\"file\", file.slice(rangeStart));\n        xhr.send(formData);\n        return effect_Micro__WEBPACK_IMPORTED_MODULE_1__.sync(()=>xhr.abort());\n    });\nconst uploadFile = (file, presigned, opts)=>(0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.fetchEff)(presigned.url, {\n        method: \"HEAD\"\n    }).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.map(({ headers })=>parseInt(headers.get(\"x-ut-range-start\") ?? \"0\", 10)), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.tap((start)=>opts.onUploadProgress?.({\n            delta: start,\n            loaded: start\n        })), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.flatMap((start)=>uploadWithProgress(file, start, presigned, (progressEvent)=>opts.onUploadProgress?.({\n                delta: progressEvent.delta,\n                loaded: progressEvent.loaded + start\n            }))), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.map(effect_Function__WEBPACK_IMPORTED_MODULE_2__.unsafeCoerce), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.map((uploadResponse)=>({\n            name: file.name,\n            size: file.size,\n            key: presigned.key,\n            lastModified: file.lastModified,\n            serverData: uploadResponse.serverData,\n            url: uploadResponse.url,\n            appUrl: uploadResponse.appUrl,\n            customId: presigned.customId,\n            type: file.type\n        })));\nconst uploadFilesInternal = (endpoint, opts)=>{\n    // classic service right here\n    const reportEventToUT = createUTReporter({\n        endpoint: String(endpoint),\n        package: opts.package,\n        url: opts.url,\n        headers: opts.headers\n    });\n    const totalSize = opts.files.reduce((acc, f)=>acc + f.size, 0);\n    let totalLoaded = 0;\n    return reportEventToUT(\"upload\", {\n        input: \"input\" in opts ? opts.input : null,\n        files: opts.files.map((f)=>({\n                name: f.name,\n                size: f.size,\n                type: f.type,\n                lastModified: f.lastModified\n            }))\n    }).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.flatMap((presigneds)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.forEach(presigneds, (presigned, i)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.flatMap(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.sync(()=>opts.onUploadBegin?.({\n                    file: opts.files[i].name\n                })), ()=>uploadFile(opts.files[i], presigned, {\n                    onUploadProgress: (ev)=>{\n                        totalLoaded += ev.delta;\n                        opts.onUploadProgress?.({\n                            file: opts.files[i],\n                            progress: Math.round(ev.loaded / opts.files[i].size * 100),\n                            loaded: ev.loaded,\n                            delta: ev.delta,\n                            totalLoaded,\n                            totalProgress: Math.round(totalLoaded / totalSize * 100)\n                        });\n                    }\n                })), {\n            concurrency: 6\n        })), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.provideService(_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.FetchContext, window.fetch));\n};\n\nconst version = version$1;\n/**\n * Validate that a file is of a valid type given a route config\n * @public\n */ const isValidFileType = (file, routeConfig)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.runSync((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.getTypeFromFileName)(file.name, (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.objectKeys)(routeConfig)).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.map((type)=>file.type.includes(type)), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.orElseSucceed(()=>false)));\n/**\n * Validate that a file is of a valid size given a route config\n * @public\n */ const isValidFileSize = (file, routeConfig)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.runSync((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.getTypeFromFileName)(file.name, (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.objectKeys)(routeConfig)).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.flatMap((type)=>(0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.fileSizeToBytes)(routeConfig[type].maxFileSize)), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.map((maxFileSize)=>file.size <= maxFileSize), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.orElseSucceed(()=>false)));\n/**\n * Generate a typed uploader for a given FileRouter\n * @public\n */ const genUploader = (initOpts)=>{\n    const controllableUpload = async (slug, opts)=>{\n        const uploads = new Map();\n        const utReporter = createUTReporter({\n            endpoint: String(slug),\n            package: initOpts.package,\n            url: (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.resolveMaybeUrlArg)(initOpts?.url),\n            headers: opts.headers\n        });\n        const presigneds = await effect_Micro__WEBPACK_IMPORTED_MODULE_1__.runPromise(utReporter(\"upload\", {\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n            input: \"input\" in opts ? opts.input : null,\n            files: opts.files.map((f)=>({\n                    name: f.name,\n                    size: f.size,\n                    type: f.type,\n                    lastModified: f.lastModified\n                }))\n        }).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.provideService(_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.FetchContext, window.fetch)));\n        const totalSize = opts.files.reduce((acc, f)=>acc + f.size, 0);\n        let totalLoaded = 0;\n        const uploadEffect = (file, presigned)=>uploadFile(file, presigned, {\n                onUploadProgress: (progressEvent)=>{\n                    totalLoaded += progressEvent.delta;\n                    opts.onUploadProgress?.({\n                        ...progressEvent,\n                        file,\n                        progress: Math.round(progressEvent.loaded / file.size * 100),\n                        totalLoaded,\n                        totalProgress: Math.round(totalLoaded / totalSize * 100)\n                    });\n                }\n            }).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.provideService(_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.FetchContext, window.fetch));\n        for (const [i, p] of presigneds.entries()){\n            const file = opts.files[i];\n            const deferred = createDeferred();\n            uploads.set(file, {\n                deferred,\n                presigned: p\n            });\n            void effect_Micro__WEBPACK_IMPORTED_MODULE_1__.runPromiseExit(uploadEffect(file, p), {\n                signal: deferred.ac.signal\n            }).then((result)=>{\n                if (result._tag === \"Right\") {\n                    return deferred.resolve(result.right);\n                } else if (result.left._tag === \"Interrupt\") {\n                    throw new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadPausedError();\n                }\n                throw effect_Micro__WEBPACK_IMPORTED_MODULE_1__.causeSquash(result.left);\n            }).catch((err)=>{\n                if (err instanceof _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadPausedError) return;\n                deferred.reject(err);\n            });\n        }\n        /**\n     * Pause an ongoing upload\n     * @param file The file upload you want to pause. Can be omitted to pause all files\n     */ const pauseUpload = (file)=>{\n            const files = (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.asArray)(file ?? opts.files);\n            for (const file of files){\n                const upload = uploads.get(file);\n                if (!upload) return;\n                if (upload.deferred.ac.signal.aborted) {\n                    // Cancel the upload if it's already been paused\n                    throw new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadAbortedError();\n                }\n                upload.deferred.ac.abort();\n            }\n        };\n        /**\n     * Resume a paused upload\n     * @param file The file upload you want to resume. Can be omitted to resume all files\n     */ const resumeUpload = (file)=>{\n            const files = (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.asArray)(file ?? opts.files);\n            for (const file of files){\n                const upload = uploads.get(file);\n                if (!upload) throw \"No upload found\";\n                upload.deferred.ac = new AbortController();\n                void effect_Micro__WEBPACK_IMPORTED_MODULE_1__.runPromiseExit(uploadEffect(file, upload.presigned), {\n                    signal: upload.deferred.ac.signal\n                }).then((result)=>{\n                    if (result._tag === \"Right\") {\n                        return upload.deferred.resolve(result.right);\n                    } else if (result.left._tag === \"Interrupt\") {\n                        throw new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadPausedError();\n                    }\n                    throw effect_Micro__WEBPACK_IMPORTED_MODULE_1__.causeSquash(result.left);\n                }).catch((err)=>{\n                    if (err instanceof _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadPausedError) return;\n                    upload.deferred.reject(err);\n                });\n            }\n        };\n        /**\n     * Wait for an upload to complete\n     * @param file The file upload you want to wait for. Can be omitted to wait for all files\n     */ const done = async (file)=>{\n            const promises = [];\n            const files = (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.asArray)(file ?? opts.files);\n            for (const file of files){\n                const upload = uploads.get(file);\n                if (!upload) throw \"No upload found\";\n                promises.push(upload.deferred.promise);\n            }\n            const results = await Promise.all(promises);\n            return file ? results[0] : results;\n        };\n        return {\n            pauseUpload,\n            resumeUpload,\n            done\n        };\n    };\n    /**\n   * One step upload function that both requests presigned URLs\n   * and then uploads the files to UploadThing\n   */ const typedUploadFiles = (endpoint, opts)=>uploadFilesInternal(endpoint, {\n            ...opts,\n            skipPolling: {},\n            url: (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.resolveMaybeUrlArg)(initOpts?.url),\n            package: initOpts.package,\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n            input: opts.input\n        }).pipe((effect)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.runPromiseExit(effect, opts.signal && {\n                signal: opts.signal\n            })).then((exit)=>{\n            if (exit._tag === \"Right\") {\n                return exit.right;\n            } else if (exit.left._tag === \"Interrupt\") {\n                throw new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadAbortedError();\n            }\n            throw effect_Micro__WEBPACK_IMPORTED_MODULE_1__.causeSquash(exit.left);\n        });\n    return {\n        uploadFiles: typedUploadFiles,\n        createUpload: controllableUpload\n    };\n};\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvdXBsb2FkdGhpbmcvY2xpZW50L2luZGV4LmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzQztBQUM4TTtBQUMzRjtBQUMxRzs7QUFFL0M7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFEQUFxRCw2Q0FBUztBQUM5RDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixnREFBZ0QsaURBQWE7QUFDN0Q7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLDZEQUFRO0FBQzVDO0FBQ0E7QUFDQTtBQUNBLGFBQWEsT0FBTyxpREFBYSxDQUFDLGtFQUFpQjtBQUNuRDtBQUNBO0FBQ0E7QUFDQSxZQUFZLDZDQUFTLENBQUMseURBQVksR0FBRyxrREFBYyxvQkFBb0IsOENBQVUsS0FBSyxpRUFBZ0I7QUFDdEc7QUFDQSx3REFBd0QsS0FBSztBQUM3RDtBQUNBLGlCQUFpQixLQUFLLGtEQUFjLHlCQUF5Qiw4Q0FBVSxLQUFLLGlFQUFnQjtBQUM1RiwwQkFBMEIsK0VBQTBCO0FBQ3BEO0FBQ0E7QUFDQSxpQkFBaUIsS0FBSyxrREFBYyxxQkFBcUIsOENBQVUsS0FBSyxpRUFBZ0I7QUFDeEY7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsU0FBUzs7QUFFVCw0RUFBNEUsK0NBQVc7QUFDdkY7QUFDQTtBQUNBLCtDQUErQyxXQUFXO0FBQzFEO0FBQ0E7QUFDQSxtREFBbUQsUUFBUTtBQUMzRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLFNBQVM7QUFDVDtBQUNBLDJEQUEyRCxpREFBYSxpQkFBaUIsNkNBQVMsZUFBZSxZQUFZLEVBQUUsZ0JBQWdCLElBQUksNkJBQTZCO0FBQ2hMLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsaUVBQWdCO0FBQ3ZDO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxlQUFlLDhDQUFVO0FBQ3pCLEtBQUs7QUFDTCw0Q0FBNEMsNkRBQVE7QUFDcEQ7QUFDQSxLQUFLLE9BQU8sNkNBQVMsSUFBSSxTQUFTLDBEQUEwRCw2Q0FBUztBQUNyRztBQUNBO0FBQ0EsU0FBUyxJQUFJLGlEQUFhO0FBQzFCO0FBQ0E7QUFDQSxhQUFhLEtBQUssNkNBQVMsQ0FBQyx5REFBWSxHQUFHLDZDQUFTO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsS0FBSyxPQUFPLGlEQUFhLGVBQWUsaURBQWEsNkJBQTZCLGlEQUFhLENBQUMsOENBQVU7QUFDMUc7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsU0FBUyxJQUFJLHdEQUFvQixDQUFDLDZEQUFZO0FBQzlDOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaURBQWlELGlEQUFhLENBQUMsd0VBQW1CLFlBQVksK0RBQVUsb0JBQW9CLDZDQUFTLG9DQUFvQyx1REFBbUI7QUFDNUw7QUFDQTtBQUNBO0FBQ0EsaURBQWlELGlEQUFhLENBQUMsd0VBQW1CLFlBQVksK0RBQVUsb0JBQW9CLGlEQUFhLFNBQVMsb0VBQWUsa0NBQWtDLDZDQUFTLDJDQUEyQyx1REFBbUI7QUFDMVE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLHVFQUFrQjtBQUNuQztBQUNBLFNBQVM7QUFDVCxpQ0FBaUMsb0RBQWdCO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLFNBQVMsT0FBTyx3REFBb0IsQ0FBQyw2REFBWTtBQUNqRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0EsYUFBYSxPQUFPLHdEQUFvQixDQUFDLDZEQUFZO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixpQkFBaUIsd0RBQW9CO0FBQ3JDO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEIsOEJBQThCLGtFQUFpQjtBQUMvQztBQUNBLHNCQUFzQixxREFBaUI7QUFDdkMsYUFBYTtBQUNiLG1DQUFtQyxrRUFBaUI7QUFDcEQ7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQiw0REFBTztBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLG1FQUFrQjtBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLDREQUFPO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCLHdEQUFvQjtBQUN6QztBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCLGtDQUFrQyxrRUFBaUI7QUFDbkQ7QUFDQSwwQkFBMEIscURBQWlCO0FBQzNDLGlCQUFpQjtBQUNqQix1Q0FBdUMsa0VBQWlCO0FBQ3hEO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLDREQUFPO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCLGlCQUFpQix1RUFBa0I7QUFDbkM7QUFDQTtBQUNBO0FBQ0EsU0FBUyxpQkFBaUIsd0RBQW9CO0FBQzlDO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxjQUFjO0FBQ2QsMEJBQTBCLG1FQUFrQjtBQUM1QztBQUNBLGtCQUFrQixxREFBaUI7QUFDbkMsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRWtFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY29ycHVzLy4vbm9kZV9tb2R1bGVzL3VwbG9hZHRoaW5nL2NsaWVudC9pbmRleC5qcz82YTE5Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIE1pY3JvIGZyb20gJ2VmZmVjdC9NaWNybyc7XG5pbXBvcnQgeyBmZXRjaEVmZiwgcGFyc2VSZXNwb25zZUpzb24sIFVwbG9hZFRoaW5nRXJyb3IsIGdldEVycm9yVHlwZUZyb21TdGF0dXNDb2RlLCBGZXRjaENvbnRleHQsIGdldFR5cGVGcm9tRmlsZU5hbWUsIG9iamVjdEtleXMsIGZpbGVTaXplVG9CeXRlcywgcmVzb2x2ZU1heWJlVXJsQXJnLCBVcGxvYWRQYXVzZWRFcnJvciwgVXBsb2FkQWJvcnRlZEVycm9yLCBhc0FycmF5IH0gZnJvbSAnQHVwbG9hZHRoaW5nL3NoYXJlZCc7XG5leHBvcnQgeyBVcGxvYWRBYm9ydGVkRXJyb3IsIFVwbG9hZFBhdXNlZEVycm9yLCBnZW5lcmF0ZUNsaWVudERyb3B6b25lQWNjZXB0LCBnZW5lcmF0ZU1pbWVUeXBlcywgZ2VuZXJhdGVQZXJtaXR0ZWRGaWxlVHlwZXMgfSBmcm9tICdAdXBsb2FkdGhpbmcvc2hhcmVkJztcbmltcG9ydCB7IHVuc2FmZUNvZXJjZSB9IGZyb20gJ2VmZmVjdC9GdW5jdGlvbic7XG5cbnZhciB2ZXJzaW9uJDEgPSBcIjcuMC4yXCI7XG5cbmNvbnN0IGNyZWF0ZURlZmVycmVkID0gKCk9PntcbiAgICBsZXQgcmVzb2x2ZTtcbiAgICBsZXQgcmVqZWN0O1xuICAgIGNvbnN0IGFjID0gbmV3IEFib3J0Q29udHJvbGxlcigpO1xuICAgIGNvbnN0IHByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzLCByZWopPT57XG4gICAgICAgIHJlc29sdmUgPSByZXM7XG4gICAgICAgIHJlamVjdCA9IHJlajtcbiAgICB9KTtcbiAgICByZXR1cm4ge1xuICAgICAgICBwcm9taXNlLFxuICAgICAgICBhYyxcbiAgICAgICAgcmVzb2x2ZSxcbiAgICAgICAgcmVqZWN0XG4gICAgfTtcbn07XG5cbmNvbnN0IGNyZWF0ZUFQSVJlcXVlc3RVcmwgPSAoY29uZmlnKT0+e1xuICAgIGNvbnN0IHVybCA9IG5ldyBVUkwoY29uZmlnLnVybCk7XG4gICAgY29uc3QgcXVlcnlQYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHVybC5zZWFyY2gpO1xuICAgIHF1ZXJ5UGFyYW1zLnNldChcImFjdGlvblR5cGVcIiwgY29uZmlnLmFjdGlvblR5cGUpO1xuICAgIHF1ZXJ5UGFyYW1zLnNldChcInNsdWdcIiwgY29uZmlnLnNsdWcpO1xuICAgIHVybC5zZWFyY2ggPSBxdWVyeVBhcmFtcy50b1N0cmluZygpO1xuICAgIHJldHVybiB1cmw7XG59O1xuLyoqXG4gKiBDcmVhdGVzIGEgXCJjbGllbnRcIiBmb3IgcmVwb3J0aW5nIGV2ZW50cyB0byB0aGUgVXBsb2FkVGhpbmcgc2VydmVyIHZpYSB0aGUgdXNlcidzIEFQSSBlbmRwb2ludC5cbiAqIEV2ZW50cyBhcmUgaGFuZGxlZCBpbiBcIi4vaGFuZGxlci50cyBzdGFydGluZyBhdCBMMTEyXCJcbiAqLyBjb25zdCBjcmVhdGVVVFJlcG9ydGVyID0gKGNmZyk9Pih0eXBlLCBwYXlsb2FkKT0+TWljcm8uZ2VuKGZ1bmN0aW9uKigpIHtcbiAgICAgICAgICAgIGNvbnN0IHVybCA9IGNyZWF0ZUFQSVJlcXVlc3RVcmwoe1xuICAgICAgICAgICAgICAgIHVybDogY2ZnLnVybCxcbiAgICAgICAgICAgICAgICBzbHVnOiBjZmcuZW5kcG9pbnQsXG4gICAgICAgICAgICAgICAgYWN0aW9uVHlwZTogdHlwZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25zdCBoZWFkZXJzID0gbmV3IEhlYWRlcnMoKHlpZWxkKiBNaWNyby5wcm9taXNlKGFzeW5jICgpPT50eXBlb2YgY2ZnLmhlYWRlcnMgPT09IFwiZnVuY3Rpb25cIiA/IGF3YWl0IGNmZy5oZWFkZXJzKCkgOiBjZmcuaGVhZGVycykpKTtcbiAgICAgICAgICAgIGhlYWRlcnMuc2V0KFwieC11cGxvYWR0aGluZy1wYWNrYWdlXCIsIGNmZy5wYWNrYWdlKTtcbiAgICAgICAgICAgIGhlYWRlcnMuc2V0KFwieC11cGxvYWR0aGluZy12ZXJzaW9uXCIsIHZlcnNpb24kMSk7XG4gICAgICAgICAgICBoZWFkZXJzLnNldChcIkNvbnRlbnQtVHlwZVwiLCBcImFwcGxpY2F0aW9uL2pzb25cIik7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkKiBmZXRjaEVmZih1cmwsIHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHBheWxvYWQpLFxuICAgICAgICAgICAgICAgIGhlYWRlcnNcbiAgICAgICAgICAgIH0pLnBpcGUoTWljcm8uYW5kVGhlbihwYXJzZVJlc3BvbnNlSnNvbiksIC8qKlxuICAgICAgICAgKiBXZSBkb24ndCBfbmVlZF8gdG8gdmFsaWRhdGUgdGhlIHJlc3BvbnNlIGhlcmUsIGp1c3QgY2FzdCBpdCBmb3Igbm93LlxuICAgICAgICAgKiBBcyBvZiBub3csIEBlZmZlY3Qvc2NoZW1hIGluY2x1ZGVzIHF1aXRlIGEgZmV3IGJ5dGVzIHdlIGN1dCBvdXQgYnkgdGhpcy4uLlxuICAgICAgICAgKiBXZSBoYXZlIFwic3Ryb25nIHR5cGluZ1wiIG9uIHRoZSBiYWNrZW5kIHRoYXQgZW5zdXJlcyB0aGUgc2hhcGUgc2hvdWxkIG1hdGNoLlxuICAgICAgICAgKi8gTWljcm8ubWFwKHVuc2FmZUNvZXJjZSksIE1pY3JvLmNhdGNoVGFnKFwiRmV0Y2hFcnJvclwiLCAoZSk9Pk1pY3JvLmZhaWwobmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICBjb2RlOiBcIklOVEVSTkFMX0NMSUVOVF9FUlJPUlwiLFxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBgRmFpbGVkIHRvIHJlcG9ydCBldmVudCBcIiR7dHlwZX1cIiB0byBVcGxvYWRUaGluZyBzZXJ2ZXJgLFxuICAgICAgICAgICAgICAgICAgICBjYXVzZTogZVxuICAgICAgICAgICAgICAgIH0pKSksIE1pY3JvLmNhdGNoVGFnKFwiQmFkUmVxdWVzdEVycm9yXCIsIChlKT0+TWljcm8uZmFpbChuZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICAgICAgICAgIGNvZGU6IGdldEVycm9yVHlwZUZyb21TdGF0dXNDb2RlKGUuc3RhdHVzKSxcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogZS5nZXRNZXNzYWdlKCksXG4gICAgICAgICAgICAgICAgICAgIGNhdXNlOiBlLmpzb25cbiAgICAgICAgICAgICAgICB9KSkpLCBNaWNyby5jYXRjaFRhZyhcIkludmFsaWRKc29uXCIsIChlKT0+TWljcm8uZmFpbChuZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICAgICAgICAgIGNvZGU6IFwiSU5URVJOQUxfQ0xJRU5UX0VSUk9SXCIsXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIHBhcnNlIHJlc3BvbnNlIGZyb20gVXBsb2FkVGhpbmcgc2VydmVyXCIsXG4gICAgICAgICAgICAgICAgICAgIGNhdXNlOiBlXG4gICAgICAgICAgICAgICAgfSkpKSk7XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgIH0pO1xuXG5jb25zdCB1cGxvYWRXaXRoUHJvZ3Jlc3MgPSAoZmlsZSwgcmFuZ2VTdGFydCwgcHJlc2lnbmVkLCBvblVwbG9hZFByb2dyZXNzKT0+TWljcm8uYXN5bmMoKHJlc3VtZSk9PntcbiAgICAgICAgY29uc3QgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAgIHhoci5vcGVuKFwiUFVUXCIsIHByZXNpZ25lZC51cmwsIHRydWUpO1xuICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIlJhbmdlXCIsIGBieXRlcz0ke3JhbmdlU3RhcnR9LWApO1xuICAgICAgICB4aHIucmVzcG9uc2VUeXBlID0gXCJqc29uXCI7XG4gICAgICAgIGxldCBwcmV2aW91c0xvYWRlZCA9IDA7XG4gICAgICAgIHhoci51cGxvYWQuYWRkRXZlbnRMaXN0ZW5lcihcInByb2dyZXNzXCIsICh7IGxvYWRlZCB9KT0+e1xuICAgICAgICAgICAgY29uc3QgZGVsdGEgPSBsb2FkZWQgLSBwcmV2aW91c0xvYWRlZDtcbiAgICAgICAgICAgIG9uVXBsb2FkUHJvZ3Jlc3M/Lih7XG4gICAgICAgICAgICAgICAgbG9hZGVkLFxuICAgICAgICAgICAgICAgIGRlbHRhXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHByZXZpb3VzTG9hZGVkID0gbG9hZGVkO1xuICAgICAgICB9KTtcbiAgICAgICAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsICgpPT57XG4gICAgICAgICAgICByZXN1bWUoeGhyLnN0YXR1cyA+PSAyMDAgJiYgeGhyLnN0YXR1cyA8IDMwMCA/IE1pY3JvLnN1Y2NlZWQoeGhyLnJlc3BvbnNlKSA6IE1pY3JvLmRpZShgWEhSIGZhaWxlZCAke3hoci5zdGF0dXN9ICR7eGhyLnN0YXR1c1RleHR9IC0gJHtKU09OLnN0cmluZ2lmeSh4aHIucmVzcG9uc2UpfWApKTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIElzIHRoZXJlIGEgY2FzZSB3aGVuIHRoZSBjbGllbnQgd291bGQgdGhyb3cgYW5kXG4gICAgICAgIC8vIGluZ2VzdCBzZXJ2ZXIgbm90IGtub3dpbmcgYWJvdXQgaXQ/IGlkdHM/XG4gICAgICAgIHhoci5hZGRFdmVudExpc3RlbmVyKFwiZXJyb3JcIiwgKCk9PntcbiAgICAgICAgICAgIHJlc3VtZShuZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICAgICAgY29kZTogXCJVUExPQURfRkFJTEVEXCJcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZChcImZpbGVcIiwgZmlsZS5zbGljZShyYW5nZVN0YXJ0KSk7XG4gICAgICAgIHhoci5zZW5kKGZvcm1EYXRhKTtcbiAgICAgICAgcmV0dXJuIE1pY3JvLnN5bmMoKCk9Pnhoci5hYm9ydCgpKTtcbiAgICB9KTtcbmNvbnN0IHVwbG9hZEZpbGUgPSAoZmlsZSwgcHJlc2lnbmVkLCBvcHRzKT0+ZmV0Y2hFZmYocHJlc2lnbmVkLnVybCwge1xuICAgICAgICBtZXRob2Q6IFwiSEVBRFwiXG4gICAgfSkucGlwZShNaWNyby5tYXAoKHsgaGVhZGVycyB9KT0+cGFyc2VJbnQoaGVhZGVycy5nZXQoXCJ4LXV0LXJhbmdlLXN0YXJ0XCIpID8/IFwiMFwiLCAxMCkpLCBNaWNyby50YXAoKHN0YXJ0KT0+b3B0cy5vblVwbG9hZFByb2dyZXNzPy4oe1xuICAgICAgICAgICAgZGVsdGE6IHN0YXJ0LFxuICAgICAgICAgICAgbG9hZGVkOiBzdGFydFxuICAgICAgICB9KSksIE1pY3JvLmZsYXRNYXAoKHN0YXJ0KT0+dXBsb2FkV2l0aFByb2dyZXNzKGZpbGUsIHN0YXJ0LCBwcmVzaWduZWQsIChwcm9ncmVzc0V2ZW50KT0+b3B0cy5vblVwbG9hZFByb2dyZXNzPy4oe1xuICAgICAgICAgICAgICAgIGRlbHRhOiBwcm9ncmVzc0V2ZW50LmRlbHRhLFxuICAgICAgICAgICAgICAgIGxvYWRlZDogcHJvZ3Jlc3NFdmVudC5sb2FkZWQgKyBzdGFydFxuICAgICAgICAgICAgfSkpKSwgTWljcm8ubWFwKHVuc2FmZUNvZXJjZSksIE1pY3JvLm1hcCgodXBsb2FkUmVzcG9uc2UpPT4oe1xuICAgICAgICAgICAgbmFtZTogZmlsZS5uYW1lLFxuICAgICAgICAgICAgc2l6ZTogZmlsZS5zaXplLFxuICAgICAgICAgICAga2V5OiBwcmVzaWduZWQua2V5LFxuICAgICAgICAgICAgbGFzdE1vZGlmaWVkOiBmaWxlLmxhc3RNb2RpZmllZCxcbiAgICAgICAgICAgIHNlcnZlckRhdGE6IHVwbG9hZFJlc3BvbnNlLnNlcnZlckRhdGEsXG4gICAgICAgICAgICB1cmw6IHVwbG9hZFJlc3BvbnNlLnVybCxcbiAgICAgICAgICAgIGFwcFVybDogdXBsb2FkUmVzcG9uc2UuYXBwVXJsLFxuICAgICAgICAgICAgY3VzdG9tSWQ6IHByZXNpZ25lZC5jdXN0b21JZCxcbiAgICAgICAgICAgIHR5cGU6IGZpbGUudHlwZVxuICAgICAgICB9KSkpO1xuY29uc3QgdXBsb2FkRmlsZXNJbnRlcm5hbCA9IChlbmRwb2ludCwgb3B0cyk9PntcbiAgICAvLyBjbGFzc2ljIHNlcnZpY2UgcmlnaHQgaGVyZVxuICAgIGNvbnN0IHJlcG9ydEV2ZW50VG9VVCA9IGNyZWF0ZVVUUmVwb3J0ZXIoe1xuICAgICAgICBlbmRwb2ludDogU3RyaW5nKGVuZHBvaW50KSxcbiAgICAgICAgcGFja2FnZTogb3B0cy5wYWNrYWdlLFxuICAgICAgICB1cmw6IG9wdHMudXJsLFxuICAgICAgICBoZWFkZXJzOiBvcHRzLmhlYWRlcnNcbiAgICB9KTtcbiAgICBjb25zdCB0b3RhbFNpemUgPSBvcHRzLmZpbGVzLnJlZHVjZSgoYWNjLCBmKT0+YWNjICsgZi5zaXplLCAwKTtcbiAgICBsZXQgdG90YWxMb2FkZWQgPSAwO1xuICAgIHJldHVybiByZXBvcnRFdmVudFRvVVQoXCJ1cGxvYWRcIiwge1xuICAgICAgICBpbnB1dDogXCJpbnB1dFwiIGluIG9wdHMgPyBvcHRzLmlucHV0IDogbnVsbCxcbiAgICAgICAgZmlsZXM6IG9wdHMuZmlsZXMubWFwKChmKT0+KHtcbiAgICAgICAgICAgICAgICBuYW1lOiBmLm5hbWUsXG4gICAgICAgICAgICAgICAgc2l6ZTogZi5zaXplLFxuICAgICAgICAgICAgICAgIHR5cGU6IGYudHlwZSxcbiAgICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IGYubGFzdE1vZGlmaWVkXG4gICAgICAgICAgICB9KSlcbiAgICB9KS5waXBlKE1pY3JvLmZsYXRNYXAoKHByZXNpZ25lZHMpPT5NaWNyby5mb3JFYWNoKHByZXNpZ25lZHMsIChwcmVzaWduZWQsIGkpPT5NaWNyby5mbGF0TWFwKE1pY3JvLnN5bmMoKCk9Pm9wdHMub25VcGxvYWRCZWdpbj8uKHtcbiAgICAgICAgICAgICAgICAgICAgZmlsZTogb3B0cy5maWxlc1tpXS5uYW1lXG4gICAgICAgICAgICAgICAgfSkpLCAoKT0+dXBsb2FkRmlsZShvcHRzLmZpbGVzW2ldLCBwcmVzaWduZWQsIHtcbiAgICAgICAgICAgICAgICAgICAgb25VcGxvYWRQcm9ncmVzczogKGV2KT0+e1xuICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxMb2FkZWQgKz0gZXYuZGVsdGE7XG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRzLm9uVXBsb2FkUHJvZ3Jlc3M/Lih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZTogb3B0cy5maWxlc1tpXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9ncmVzczogTWF0aC5yb3VuZChldi5sb2FkZWQgLyBvcHRzLmZpbGVzW2ldLnNpemUgKiAxMDApLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlZDogZXYubG9hZGVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbHRhOiBldi5kZWx0YSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbExvYWRlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbFByb2dyZXNzOiBNYXRoLnJvdW5kKHRvdGFsTG9hZGVkIC8gdG90YWxTaXplICogMTAwKVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KSksIHtcbiAgICAgICAgICAgIGNvbmN1cnJlbmN5OiA2XG4gICAgICAgIH0pKSwgTWljcm8ucHJvdmlkZVNlcnZpY2UoRmV0Y2hDb250ZXh0LCB3aW5kb3cuZmV0Y2gpKTtcbn07XG5cbmNvbnN0IHZlcnNpb24gPSB2ZXJzaW9uJDE7XG4vKipcbiAqIFZhbGlkYXRlIHRoYXQgYSBmaWxlIGlzIG9mIGEgdmFsaWQgdHlwZSBnaXZlbiBhIHJvdXRlIGNvbmZpZ1xuICogQHB1YmxpY1xuICovIGNvbnN0IGlzVmFsaWRGaWxlVHlwZSA9IChmaWxlLCByb3V0ZUNvbmZpZyk9Pk1pY3JvLnJ1blN5bmMoZ2V0VHlwZUZyb21GaWxlTmFtZShmaWxlLm5hbWUsIG9iamVjdEtleXMocm91dGVDb25maWcpKS5waXBlKE1pY3JvLm1hcCgodHlwZSk9PmZpbGUudHlwZS5pbmNsdWRlcyh0eXBlKSksIE1pY3JvLm9yRWxzZVN1Y2NlZWQoKCk9PmZhbHNlKSkpO1xuLyoqXG4gKiBWYWxpZGF0ZSB0aGF0IGEgZmlsZSBpcyBvZiBhIHZhbGlkIHNpemUgZ2l2ZW4gYSByb3V0ZSBjb25maWdcbiAqIEBwdWJsaWNcbiAqLyBjb25zdCBpc1ZhbGlkRmlsZVNpemUgPSAoZmlsZSwgcm91dGVDb25maWcpPT5NaWNyby5ydW5TeW5jKGdldFR5cGVGcm9tRmlsZU5hbWUoZmlsZS5uYW1lLCBvYmplY3RLZXlzKHJvdXRlQ29uZmlnKSkucGlwZShNaWNyby5mbGF0TWFwKCh0eXBlKT0+ZmlsZVNpemVUb0J5dGVzKHJvdXRlQ29uZmlnW3R5cGVdLm1heEZpbGVTaXplKSksIE1pY3JvLm1hcCgobWF4RmlsZVNpemUpPT5maWxlLnNpemUgPD0gbWF4RmlsZVNpemUpLCBNaWNyby5vckVsc2VTdWNjZWVkKCgpPT5mYWxzZSkpKTtcbi8qKlxuICogR2VuZXJhdGUgYSB0eXBlZCB1cGxvYWRlciBmb3IgYSBnaXZlbiBGaWxlUm91dGVyXG4gKiBAcHVibGljXG4gKi8gY29uc3QgZ2VuVXBsb2FkZXIgPSAoaW5pdE9wdHMpPT57XG4gICAgY29uc3QgY29udHJvbGxhYmxlVXBsb2FkID0gYXN5bmMgKHNsdWcsIG9wdHMpPT57XG4gICAgICAgIGNvbnN0IHVwbG9hZHMgPSBuZXcgTWFwKCk7XG4gICAgICAgIGNvbnN0IHV0UmVwb3J0ZXIgPSBjcmVhdGVVVFJlcG9ydGVyKHtcbiAgICAgICAgICAgIGVuZHBvaW50OiBTdHJpbmcoc2x1ZyksXG4gICAgICAgICAgICBwYWNrYWdlOiBpbml0T3B0cy5wYWNrYWdlLFxuICAgICAgICAgICAgdXJsOiByZXNvbHZlTWF5YmVVcmxBcmcoaW5pdE9wdHM/LnVybCksXG4gICAgICAgICAgICBoZWFkZXJzOiBvcHRzLmhlYWRlcnNcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHByZXNpZ25lZHMgPSBhd2FpdCBNaWNyby5ydW5Qcm9taXNlKHV0UmVwb3J0ZXIoXCJ1cGxvYWRcIiwge1xuICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnNhZmUtYXNzaWdubWVudFxuICAgICAgICAgICAgaW5wdXQ6IFwiaW5wdXRcIiBpbiBvcHRzID8gb3B0cy5pbnB1dCA6IG51bGwsXG4gICAgICAgICAgICBmaWxlczogb3B0cy5maWxlcy5tYXAoKGYpPT4oe1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiBmLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHNpemU6IGYuc2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogZi50eXBlLFxuICAgICAgICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IGYubGFzdE1vZGlmaWVkXG4gICAgICAgICAgICAgICAgfSkpXG4gICAgICAgIH0pLnBpcGUoTWljcm8ucHJvdmlkZVNlcnZpY2UoRmV0Y2hDb250ZXh0LCB3aW5kb3cuZmV0Y2gpKSk7XG4gICAgICAgIGNvbnN0IHRvdGFsU2l6ZSA9IG9wdHMuZmlsZXMucmVkdWNlKChhY2MsIGYpPT5hY2MgKyBmLnNpemUsIDApO1xuICAgICAgICBsZXQgdG90YWxMb2FkZWQgPSAwO1xuICAgICAgICBjb25zdCB1cGxvYWRFZmZlY3QgPSAoZmlsZSwgcHJlc2lnbmVkKT0+dXBsb2FkRmlsZShmaWxlLCBwcmVzaWduZWQsIHtcbiAgICAgICAgICAgICAgICBvblVwbG9hZFByb2dyZXNzOiAocHJvZ3Jlc3NFdmVudCk9PntcbiAgICAgICAgICAgICAgICAgICAgdG90YWxMb2FkZWQgKz0gcHJvZ3Jlc3NFdmVudC5kZWx0YTtcbiAgICAgICAgICAgICAgICAgICAgb3B0cy5vblVwbG9hZFByb2dyZXNzPy4oe1xuICAgICAgICAgICAgICAgICAgICAgICAgLi4ucHJvZ3Jlc3NFdmVudCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9ncmVzczogTWF0aC5yb3VuZChwcm9ncmVzc0V2ZW50LmxvYWRlZCAvIGZpbGUuc2l6ZSAqIDEwMCksXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbExvYWRlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsUHJvZ3Jlc3M6IE1hdGgucm91bmQodG90YWxMb2FkZWQgLyB0b3RhbFNpemUgKiAxMDApXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLnBpcGUoTWljcm8ucHJvdmlkZVNlcnZpY2UoRmV0Y2hDb250ZXh0LCB3aW5kb3cuZmV0Y2gpKTtcbiAgICAgICAgZm9yIChjb25zdCBbaSwgcF0gb2YgcHJlc2lnbmVkcy5lbnRyaWVzKCkpe1xuICAgICAgICAgICAgY29uc3QgZmlsZSA9IG9wdHMuZmlsZXNbaV07XG4gICAgICAgICAgICBjb25zdCBkZWZlcnJlZCA9IGNyZWF0ZURlZmVycmVkKCk7XG4gICAgICAgICAgICB1cGxvYWRzLnNldChmaWxlLCB7XG4gICAgICAgICAgICAgICAgZGVmZXJyZWQsXG4gICAgICAgICAgICAgICAgcHJlc2lnbmVkOiBwXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHZvaWQgTWljcm8ucnVuUHJvbWlzZUV4aXQodXBsb2FkRWZmZWN0KGZpbGUsIHApLCB7XG4gICAgICAgICAgICAgICAgc2lnbmFsOiBkZWZlcnJlZC5hYy5zaWduYWxcbiAgICAgICAgICAgIH0pLnRoZW4oKHJlc3VsdCk9PntcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0Ll90YWcgPT09IFwiUmlnaHRcIikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucmVzb2x2ZShyZXN1bHQucmlnaHQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzdWx0LmxlZnQuX3RhZyA9PT0gXCJJbnRlcnJ1cHRcIikge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXBsb2FkUGF1c2VkRXJyb3IoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhyb3cgTWljcm8uY2F1c2VTcXVhc2gocmVzdWx0LmxlZnQpO1xuICAgICAgICAgICAgfSkuY2F0Y2goKGVycik9PntcbiAgICAgICAgICAgICAgICBpZiAoZXJyIGluc3RhbmNlb2YgVXBsb2FkUGF1c2VkRXJyb3IpIHJldHVybjtcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAqIFBhdXNlIGFuIG9uZ29pbmcgdXBsb2FkXG4gICAgICogQHBhcmFtIGZpbGUgVGhlIGZpbGUgdXBsb2FkIHlvdSB3YW50IHRvIHBhdXNlLiBDYW4gYmUgb21pdHRlZCB0byBwYXVzZSBhbGwgZmlsZXNcbiAgICAgKi8gY29uc3QgcGF1c2VVcGxvYWQgPSAoZmlsZSk9PntcbiAgICAgICAgICAgIGNvbnN0IGZpbGVzID0gYXNBcnJheShmaWxlID8/IG9wdHMuZmlsZXMpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBmaWxlIG9mIGZpbGVzKXtcbiAgICAgICAgICAgICAgICBjb25zdCB1cGxvYWQgPSB1cGxvYWRzLmdldChmaWxlKTtcbiAgICAgICAgICAgICAgICBpZiAoIXVwbG9hZCkgcmV0dXJuO1xuICAgICAgICAgICAgICAgIGlmICh1cGxvYWQuZGVmZXJyZWQuYWMuc2lnbmFsLmFib3J0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQ2FuY2VsIHRoZSB1cGxvYWQgaWYgaXQncyBhbHJlYWR5IGJlZW4gcGF1c2VkXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVcGxvYWRBYm9ydGVkRXJyb3IoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdXBsb2FkLmRlZmVycmVkLmFjLmFib3J0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAqIFJlc3VtZSBhIHBhdXNlZCB1cGxvYWRcbiAgICAgKiBAcGFyYW0gZmlsZSBUaGUgZmlsZSB1cGxvYWQgeW91IHdhbnQgdG8gcmVzdW1lLiBDYW4gYmUgb21pdHRlZCB0byByZXN1bWUgYWxsIGZpbGVzXG4gICAgICovIGNvbnN0IHJlc3VtZVVwbG9hZCA9IChmaWxlKT0+e1xuICAgICAgICAgICAgY29uc3QgZmlsZXMgPSBhc0FycmF5KGZpbGUgPz8gb3B0cy5maWxlcyk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGZpbGUgb2YgZmlsZXMpe1xuICAgICAgICAgICAgICAgIGNvbnN0IHVwbG9hZCA9IHVwbG9hZHMuZ2V0KGZpbGUpO1xuICAgICAgICAgICAgICAgIGlmICghdXBsb2FkKSB0aHJvdyBcIk5vIHVwbG9hZCBmb3VuZFwiO1xuICAgICAgICAgICAgICAgIHVwbG9hZC5kZWZlcnJlZC5hYyA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTtcbiAgICAgICAgICAgICAgICB2b2lkIE1pY3JvLnJ1blByb21pc2VFeGl0KHVwbG9hZEVmZmVjdChmaWxlLCB1cGxvYWQucHJlc2lnbmVkKSwge1xuICAgICAgICAgICAgICAgICAgICBzaWduYWw6IHVwbG9hZC5kZWZlcnJlZC5hYy5zaWduYWxcbiAgICAgICAgICAgICAgICB9KS50aGVuKChyZXN1bHQpPT57XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuX3RhZyA9PT0gXCJSaWdodFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXBsb2FkLmRlZmVycmVkLnJlc29sdmUocmVzdWx0LnJpZ2h0KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXN1bHQubGVmdC5fdGFnID09PSBcIkludGVycnVwdFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXBsb2FkUGF1c2VkRXJyb3IoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBNaWNyby5jYXVzZVNxdWFzaChyZXN1bHQubGVmdCk7XG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goKGVycik9PntcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVyciBpbnN0YW5jZW9mIFVwbG9hZFBhdXNlZEVycm9yKSByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZC5kZWZlcnJlZC5yZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICogV2FpdCBmb3IgYW4gdXBsb2FkIHRvIGNvbXBsZXRlXG4gICAgICogQHBhcmFtIGZpbGUgVGhlIGZpbGUgdXBsb2FkIHlvdSB3YW50IHRvIHdhaXQgZm9yLiBDYW4gYmUgb21pdHRlZCB0byB3YWl0IGZvciBhbGwgZmlsZXNcbiAgICAgKi8gY29uc3QgZG9uZSA9IGFzeW5jIChmaWxlKT0+e1xuICAgICAgICAgICAgY29uc3QgcHJvbWlzZXMgPSBbXTtcbiAgICAgICAgICAgIGNvbnN0IGZpbGVzID0gYXNBcnJheShmaWxlID8/IG9wdHMuZmlsZXMpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBmaWxlIG9mIGZpbGVzKXtcbiAgICAgICAgICAgICAgICBjb25zdCB1cGxvYWQgPSB1cGxvYWRzLmdldChmaWxlKTtcbiAgICAgICAgICAgICAgICBpZiAoIXVwbG9hZCkgdGhyb3cgXCJObyB1cGxvYWQgZm91bmRcIjtcbiAgICAgICAgICAgICAgICBwcm9taXNlcy5wdXNoKHVwbG9hZC5kZWZlcnJlZC5wcm9taXNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7XG4gICAgICAgICAgICByZXR1cm4gZmlsZSA/IHJlc3VsdHNbMF0gOiByZXN1bHRzO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcGF1c2VVcGxvYWQsXG4gICAgICAgICAgICByZXN1bWVVcGxvYWQsXG4gICAgICAgICAgICBkb25lXG4gICAgICAgIH07XG4gICAgfTtcbiAgICAvKipcbiAgICogT25lIHN0ZXAgdXBsb2FkIGZ1bmN0aW9uIHRoYXQgYm90aCByZXF1ZXN0cyBwcmVzaWduZWQgVVJMc1xuICAgKiBhbmQgdGhlbiB1cGxvYWRzIHRoZSBmaWxlcyB0byBVcGxvYWRUaGluZ1xuICAgKi8gY29uc3QgdHlwZWRVcGxvYWRGaWxlcyA9IChlbmRwb2ludCwgb3B0cyk9PnVwbG9hZEZpbGVzSW50ZXJuYWwoZW5kcG9pbnQsIHtcbiAgICAgICAgICAgIC4uLm9wdHMsXG4gICAgICAgICAgICBza2lwUG9sbGluZzoge30sXG4gICAgICAgICAgICB1cmw6IHJlc29sdmVNYXliZVVybEFyZyhpbml0T3B0cz8udXJsKSxcbiAgICAgICAgICAgIHBhY2thZ2U6IGluaXRPcHRzLnBhY2thZ2UsXG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVuc2FmZS1tZW1iZXItYWNjZXNzXG4gICAgICAgICAgICBpbnB1dDogb3B0cy5pbnB1dFxuICAgICAgICB9KS5waXBlKChlZmZlY3QpPT5NaWNyby5ydW5Qcm9taXNlRXhpdChlZmZlY3QsIG9wdHMuc2lnbmFsICYmIHtcbiAgICAgICAgICAgICAgICBzaWduYWw6IG9wdHMuc2lnbmFsXG4gICAgICAgICAgICB9KSkudGhlbigoZXhpdCk9PntcbiAgICAgICAgICAgIGlmIChleGl0Ll90YWcgPT09IFwiUmlnaHRcIikge1xuICAgICAgICAgICAgICAgIHJldHVybiBleGl0LnJpZ2h0O1xuICAgICAgICAgICAgfSBlbHNlIGlmIChleGl0LmxlZnQuX3RhZyA9PT0gXCJJbnRlcnJ1cHRcIikge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBVcGxvYWRBYm9ydGVkRXJyb3IoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRocm93IE1pY3JvLmNhdXNlU3F1YXNoKGV4aXQubGVmdCk7XG4gICAgICAgIH0pO1xuICAgIHJldHVybiB7XG4gICAgICAgIHVwbG9hZEZpbGVzOiB0eXBlZFVwbG9hZEZpbGVzLFxuICAgICAgICBjcmVhdGVVcGxvYWQ6IGNvbnRyb2xsYWJsZVVwbG9hZFxuICAgIH07XG59O1xuXG5leHBvcnQgeyBnZW5VcGxvYWRlciwgaXNWYWxpZEZpbGVTaXplLCBpc1ZhbGlkRmlsZVR5cGUsIHZlcnNpb24gfTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/uploadthing/client/index.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/uploadthing/internal/types.js":
/*!****************************************************!*\
  !*** ./node_modules/uploadthing/internal/types.js ***!
  \****************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   UTFiles: () => (/* binding */ UTFiles)\n/* harmony export */ });\n/**\n * Marker used to append a `customId` to the incoming file data in `.middleware()`\n * @example\n * ```ts\n * .middleware((opts) => {\n *   return {\n *     [UTFiles]: opts.files.map((file) => ({\n *       ...file,\n *       customId: generateId(),\n *     }))\n *   };\n * })\n * ```\n */ const UTFiles = Symbol(\"uploadthing-custom-id-symbol\");\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvdXBsb2FkdGhpbmcvaW50ZXJuYWwvdHlwZXMuanMiLCJtYXBwaW5ncyI6Ijs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVtQiIsInNvdXJjZXMiOlsid2VicGFjazovL2NvcnB1cy8uL25vZGVfbW9kdWxlcy91cGxvYWR0aGluZy9pbnRlcm5hbC90eXBlcy5qcz8yNjkxIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTWFya2VyIHVzZWQgdG8gYXBwZW5kIGEgYGN1c3RvbUlkYCB0byB0aGUgaW5jb21pbmcgZmlsZSBkYXRhIGluIGAubWlkZGxld2FyZSgpYFxuICogQGV4YW1wbGVcbiAqIGBgYHRzXG4gKiAubWlkZGxld2FyZSgob3B0cykgPT4ge1xuICogICByZXR1cm4ge1xuICogICAgIFtVVEZpbGVzXTogb3B0cy5maWxlcy5tYXAoKGZpbGUpID0+ICh7XG4gKiAgICAgICAuLi5maWxlLFxuICogICAgICAgY3VzdG9tSWQ6IGdlbmVyYXRlSWQoKSxcbiAqICAgICB9KSlcbiAqICAgfTtcbiAqIH0pXG4gKiBgYGBcbiAqLyBjb25zdCBVVEZpbGVzID0gU3ltYm9sKFwidXBsb2FkdGhpbmctY3VzdG9tLWlkLXN5bWJvbFwiKTtcblxuZXhwb3J0IHsgVVRGaWxlcyB9O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/uploadthing/internal/types.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/uploadthing/next/index.js":
/*!************************************************!*\
  !*** ./node_modules/uploadthing/next/index.js ***!
  \************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   UTFiles: () => (/* reexport safe */ _internal_types_js__WEBPACK_IMPORTED_MODULE_0__.UTFiles),\n/* harmony export */   createRouteHandler: () => (/* binding */ createRouteHandler),\n/* harmony export */   createUploadthing: () => (/* binding */ createUploadthing)\n/* harmony export */ });\n/* harmony import */ var effect_Effect__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! effect/Effect */ \"(rsc)/./node_modules/effect/dist/esm/Effect.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpClient.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpApp.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpServerResponse.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpServerRequest.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpRouter.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpClientRequest.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpIncomingMessage.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpClientResponse.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpBody.js\");\n/* harmony import */ var _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @effect/schema/Schema */ \"(rsc)/./node_modules/@effect/schema/dist/esm/Schema.js\");\n/* harmony import */ var effect_log__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! effect-log */ \"(rsc)/./node_modules/effect-log/dist/esm/PrettyLogger.js\");\n/* harmony import */ var effect_Config__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! effect/Config */ \"(rsc)/./node_modules/effect/dist/esm/Config.js\");\n/* harmony import */ var effect_Context__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! effect/Context */ \"(rsc)/./node_modules/effect/dist/esm/Context.js\");\n/* harmony import */ var effect_Layer__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! effect/Layer */ \"(rsc)/./node_modules/effect/dist/esm/Layer.js\");\n/* harmony import */ var effect_ManagedRuntime__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! effect/ManagedRuntime */ \"(rsc)/./node_modules/effect/dist/esm/ManagedRuntime.js\");\n/* harmony import */ var effect_Match__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! effect/Match */ \"(rsc)/./node_modules/effect/dist/esm/Match.js\");\n/* harmony import */ var _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @uploadthing/shared */ \"(rsc)/./node_modules/@uploadthing/shared/dist/index.js\");\n/* harmony import */ var effect_ConfigProvider__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! effect/ConfigProvider */ \"(rsc)/./node_modules/effect/dist/esm/ConfigProvider.js\");\n/* harmony import */ var effect_Stream__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! effect/Stream */ \"(rsc)/./node_modules/effect/dist/esm/Stream.js\");\n/* harmony import */ var effect_Logger__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! effect/Logger */ \"(rsc)/./node_modules/effect/dist/esm/Logger.js\");\n/* harmony import */ var effect_LogLevel__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! effect/LogLevel */ \"(rsc)/./node_modules/effect/dist/esm/LogLevel.js\");\n/* harmony import */ var effect_Data__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! effect/Data */ \"(rsc)/./node_modules/effect/dist/esm/Data.js\");\n/* harmony import */ var _internal_types_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../internal/types.js */ \"(rsc)/./node_modules/uploadthing/internal/types.js\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar version = \"7.0.2\";\n\n_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.Literal(..._uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.ValidContentDispositions);\n_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.Literal(..._uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.ValidACLs);\n/**\n * Valid options for the `?actionType` query param\n */ const ActionType = _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.Literal(\"upload\");\n/**\n * Valid options for the `uploadthing-hook` header\n * for requests coming from UT server\n */ const UploadThingHook = _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.Literal(\"callback\", \"error\");\n/**\n * =============================================================================\n * =========================== Configuration ===================================\n * =============================================================================\n */ const DecodeString = _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.transform(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.Uint8ArrayFromSelf, _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.String, {\n    decode: (data)=>new TextDecoder().decode(data),\n    encode: (data)=>new TextEncoder().encode(data)\n});\nconst ParsedToken = _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.Struct({\n    apiKey: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.String.pipe(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.startsWith(\"sk_\")),\n    appId: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    regions: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.NonEmptyArray(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.String),\n    ingestHost: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.String.pipe(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.optionalWith({\n        default: ()=>\"ingest.uploadthing.com\"\n    }))\n});\nconst UploadThingToken = _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.Uint8ArrayFromBase64.pipe(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.compose(DecodeString), _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.compose(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.parseJson(ParsedToken)));\n/**\n * =============================================================================\n * ======================== File Type Hierarchy ===============================\n * =============================================================================\n */ /**\n * Properties from the web File object, this is what the client sends when initiating an upload\n */ class FileUploadData extends _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.Class(\"FileUploadData\")({\n    name: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    size: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.Number,\n    type: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    lastModified: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.Number.pipe(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.optional)\n}) {\n}\n/**\n * `.middleware()` can add a customId to the incoming file data\n */ class FileUploadDataWithCustomId extends FileUploadData.extend(\"FileUploadDataWithCustomId\")({\n    customId: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.NullOr(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.String)\n}) {\n}\n/**\n * When files are uploaded, we get back\n * - a key\n * - a direct URL for the file\n * - an app-specific URL for the file (useful for scoping eg. for optimization allowed origins)\n */ class UploadedFileData extends FileUploadDataWithCustomId.extend(\"UploadedFileData\")({\n    key: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    url: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    appUrl: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.String\n}) {\n}\n/**\n * =============================================================================\n * ======================== Server Response Schemas ============================\n * =============================================================================\n */ class NewPresignedUrl extends _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.Class(\"NewPresignedUrl\")({\n    url: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    key: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    customId: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.NullOr(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.String),\n    name: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.String\n}) {\n}\nclass MetadataFetchStreamPart extends _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.Class(\"MetadataFetchStreamPart\")({\n    payload: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    signature: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    hook: UploadThingHook\n}) {\n}\nclass MetadataFetchResponse extends _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.Class(\"MetadataFetchResponse\")({\n    ok: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.Boolean\n}) {\n}\nclass CallbackResultResponse extends _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.Class(\"CallbackResultResponse\")({\n    ok: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.Boolean\n}) {\n}\n/**\n * =============================================================================\n * ======================== Client Action Payloads ============================\n * =============================================================================\n */ class UploadActionPayload extends _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.Class(\"UploadActionPayload\")({\n    files: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.Array(FileUploadData),\n    input: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.Unknown\n}) {\n}\n\n/**\n * Merge in `import.meta.env` to the built-in `process.env` provider\n * Prefix keys with `UPLOADTHING_` so we can reference just the name.\n * @example\n * process.env.UPLOADTHING_TOKEN = \"foo\"\n * Config.string(\"token\"); // Config<\"foo\">\n */ const envProvider = effect_ConfigProvider__WEBPACK_IMPORTED_MODULE_3__.fromEnv().pipe(effect_ConfigProvider__WEBPACK_IMPORTED_MODULE_3__.orElse(()=>effect_ConfigProvider__WEBPACK_IMPORTED_MODULE_3__.fromMap(new Map(Object.entries((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.filterDefinedObjectValues)(// fuck this I give up. import.meta is a mistake, someone else can fix it\n     null ?? {}))), {\n        pathDelim: \"_\"\n    })), effect_ConfigProvider__WEBPACK_IMPORTED_MODULE_3__.nested(\"uploadthing\"), effect_ConfigProvider__WEBPACK_IMPORTED_MODULE_3__.constantCase);\n/**\n * Config provider that merges the options from the object\n * and environment variables prefixed with `UPLOADTHING_`.\n * @remarks Options take precedence over environment variables.\n */ const configProvider = (options)=>effect_ConfigProvider__WEBPACK_IMPORTED_MODULE_3__.fromJson(options ?? {}).pipe(effect_ConfigProvider__WEBPACK_IMPORTED_MODULE_3__.orElse(()=>envProvider));\nconst IsDevelopment = effect_Config__WEBPACK_IMPORTED_MODULE_4__.boolean(\"isDev\").pipe(effect_Config__WEBPACK_IMPORTED_MODULE_4__.orElse(()=>effect_Config__WEBPACK_IMPORTED_MODULE_4__.succeed(typeof process !== \"undefined\" ? \"development\" : undefined).pipe(effect_Config__WEBPACK_IMPORTED_MODULE_4__.map((_)=>_ === \"development\"))), effect_Config__WEBPACK_IMPORTED_MODULE_4__.withDefault(false));\nconst UTToken = _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.Config(\"token\", UploadThingToken).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.catchTags({\n    ConfigError: (e)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n            code: e._op === \"InvalidData\" ? \"INVALID_SERVER_CONFIG\" : \"MISSING_ENV\",\n            message: e._op === \"InvalidData\" ? \"Invalid token. A token is a base64 encoded JSON object matching { apiKey: string, appId: string, regions: string[] }.\" : \"Missing token. Please set the `UPLOADTHING_TOKEN` environment variable or provide a token manually through config.\",\n            cause: e\n        })\n}));\neffect_Config__WEBPACK_IMPORTED_MODULE_4__.string(\"apiUrl\").pipe(effect_Config__WEBPACK_IMPORTED_MODULE_4__.withDefault(\"https://api.uploadthing.com\"), effect_Config__WEBPACK_IMPORTED_MODULE_4__.mapAttempt((_)=>new URL(_)), effect_Config__WEBPACK_IMPORTED_MODULE_4__.map((url)=>url.href.replace(/\\/$/, \"\")));\nconst IngestUrl = effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n    const { regions, ingestHost } = yield* UTToken;\n    const region = regions[0]; // Currently only support 1 region per app\n    return yield* effect_Config__WEBPACK_IMPORTED_MODULE_4__.string(\"ingestUrl\").pipe(effect_Config__WEBPACK_IMPORTED_MODULE_4__.withDefault(`https://${region}.${ingestHost}`), effect_Config__WEBPACK_IMPORTED_MODULE_4__.mapAttempt((_)=>new URL(_)), effect_Config__WEBPACK_IMPORTED_MODULE_4__.map((url)=>url.href.replace(/\\/$/, \"\")));\n});\n\nfunction defaultErrorFormatter(error) {\n    return {\n        message: error.message\n    };\n}\nfunction formatError(error, router) {\n    const errorFormatter = router[Object.keys(router)[0]]?._def.errorFormatter ?? defaultErrorFormatter;\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    return errorFormatter(error);\n}\n\nconst handleJsonLineStream = (schema, onChunk)=>(stream)=>{\n        let buf = \"\";\n        return stream.pipe(effect_Stream__WEBPACK_IMPORTED_MODULE_6__.decodeText(), effect_Stream__WEBPACK_IMPORTED_MODULE_6__.mapEffect((chunk)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n                buf += chunk;\n                // Scan buffer for newlines\n                const parts = buf.split(\"\\n\");\n                const validChunks = [];\n                for (const part of parts){\n                    try {\n                        // Attempt to parse chunk as JSON\n                        validChunks.push(JSON.parse(part));\n                        // Advance buffer if parsing succeeded\n                        buf = buf.slice(part.length + 1);\n                    } catch  {\n                    //\n                    }\n                }\n                yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Received chunks\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"chunk\", chunk), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"parsedChunks\", validChunks), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"buf\", buf));\n                return validChunks;\n            })), effect_Stream__WEBPACK_IMPORTED_MODULE_6__.mapEffect(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.decodeUnknown(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.Array(schema))), effect_Stream__WEBPACK_IMPORTED_MODULE_6__.mapEffect(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.forEach((part)=>onChunk(part))), effect_Stream__WEBPACK_IMPORTED_MODULE_6__.runDrain, effect_Effect__WEBPACK_IMPORTED_MODULE_5__.withLogSpan(\"handleJsonLineStream\"));\n    };\n\nconst withMinimalLogLevel = effect_Config__WEBPACK_IMPORTED_MODULE_4__.logLevel(\"logLevel\").pipe(effect_Config__WEBPACK_IMPORTED_MODULE_4__.withDefault(effect_LogLevel__WEBPACK_IMPORTED_MODULE_7__.Info), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.andThen((level)=>effect_Logger__WEBPACK_IMPORTED_MODULE_8__.minimumLogLevel(level)), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tapError((e)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logError(\"Invalid log level\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"error\", e))), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.catchTag(\"ConfigError\", (e)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n        code: \"INVALID_SERVER_CONFIG\",\n        message: \"Invalid server configuration\",\n        cause: e\n    })), effect_Layer__WEBPACK_IMPORTED_MODULE_9__.unwrapEffect);\n\nfunction getParseFn(parser) {\n    if (typeof parser.parse === \"function\") {\n        return parser.parse;\n    }\n    throw new Error(\"Invalid parser\");\n}\n\nclass FileSizeMismatch extends effect_Data__WEBPACK_IMPORTED_MODULE_10__.Error {\n    constructor(type, max, actual){\n        const reason = `You uploaded a ${type} file that was ${(0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.bytesToFileSize)(actual)}, but the limit for that type is ${max}`;\n        super({\n            reason\n        });\n        this._tag = \"FileSizeMismatch\";\n        this.name = \"FileSizeMismatchError\";\n    }\n}\nclass FileCountMismatch extends effect_Data__WEBPACK_IMPORTED_MODULE_10__.Error {\n    constructor(type, boundtype, bound, actual){\n        const reason = `You uploaded ${actual} file(s) of type '${type}', but the ${boundtype} for that type is ${bound}`;\n        super({\n            reason\n        });\n        this._tag = \"FileCountMismatch\";\n        this.name = \"FileCountMismatchError\";\n    }\n}\n// Verify that the uploaded files doesn't violate the route config,\n// e.g. uploading more videos than allowed, or a file that is larger than allowed.\n// This is double-checked on infra side, but we want to fail early to avoid network latency.\nconst assertFilesMeetConfig = (files, routeConfig)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n        const counts = {};\n        for (const file of files){\n            const type = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.getTypeFromFileName)(file.name, (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.objectKeys)(routeConfig));\n            counts[type] = (counts[type] ?? 0) + 1;\n            const sizeLimit = routeConfig[type]?.maxFileSize;\n            if (!sizeLimit) {\n                return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.InvalidRouteConfigError(type, \"maxFileSize\");\n            }\n            const sizeLimitBytes = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.fileSizeToBytes)(sizeLimit);\n            if (file.size > sizeLimitBytes) {\n                return yield* new FileSizeMismatch(type, sizeLimit, file.size);\n            }\n        }\n        for(const _key in counts){\n            const key = _key;\n            const config = routeConfig[key];\n            if (!config) return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.InvalidRouteConfigError(key);\n            const count = counts[key];\n            const min = config.minFileCount;\n            const max = config.maxFileCount;\n            if (min > max) {\n                return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                    code: \"BAD_REQUEST\",\n                    message: \"Invalid config during file count - minFileCount > maxFileCount\",\n                    cause: `minFileCount must be less than maxFileCount for key ${key}. got: ${min} > ${max}`\n                });\n            }\n            if (count < min) {\n                return yield* new FileCountMismatch(key, \"minimum\", min, count);\n            }\n            if (count > max) {\n                return yield* new FileCountMismatch(key, \"maximum\", max, count);\n            }\n        }\n        return null;\n    });\nconst extractRouterConfig = (router)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.forEach((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.objectKeys)(router), (slug)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.map((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.fillInputRouteConfig)(router[slug]._def.routerConfig), (config)=>({\n                slug,\n                config\n            })));\n\nclass MiddlewareArguments extends effect_Context__WEBPACK_IMPORTED_MODULE_11__.Tag(\"uploadthing/MiddlewareArguments\")() {\n}\nconst makeAdapterHandler = (makeMiddlewareArgs, toRequest, opts, beAdapter)=>{\n    const layer = effect_Layer__WEBPACK_IMPORTED_MODULE_9__.provide(effect_Layer__WEBPACK_IMPORTED_MODULE_9__.mergeAll(effect_log__WEBPACK_IMPORTED_MODULE_12__.layer({\n        showFiberId: false\n    }), withMinimalLogLevel, _effect_platform__WEBPACK_IMPORTED_MODULE_13__.layer, effect_Layer__WEBPACK_IMPORTED_MODULE_9__.succeed(_effect_platform__WEBPACK_IMPORTED_MODULE_13__.Fetch, opts.config?.fetch)), effect_Layer__WEBPACK_IMPORTED_MODULE_9__.setConfigProvider(configProvider(opts.config)));\n    const managed = effect_ManagedRuntime__WEBPACK_IMPORTED_MODULE_14__.make(layer);\n    const handle = effect_Effect__WEBPACK_IMPORTED_MODULE_5__.promise(()=>managed.runtime().then(_effect_platform__WEBPACK_IMPORTED_MODULE_15__.toWebHandlerRuntime));\n    const app = (...args)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.map(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.promise(()=>managed.runPromise(createRequestHandler(opts, beAdapter))), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.provideServiceEffect(MiddlewareArguments, makeMiddlewareArgs(...args)));\n    return async (...args)=>await handle.pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.ap(app(...args)), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.ap(toRequest(...args)), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.withLogSpan(\"requestHandler\"), managed.runPromise);\n};\nconst createRequestHandler = (opts, beAdapter)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n        const isDevelopment = yield* IsDevelopment;\n        const routerConfig = yield* extractRouterConfig(opts.router);\n        const handleDaemon = (()=>{\n            if (opts.config?.handleDaemonPromise) {\n                return opts.config.handleDaemonPromise;\n            }\n            return isDevelopment ? \"void\" : \"await\";\n        })();\n        if (isDevelopment && handleDaemon === \"await\") {\n            return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                code: \"INVALID_SERVER_CONFIG\",\n                message: 'handleDaemonPromise: \"await\" is forbidden in development.'\n            });\n        }\n        const GET = effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n            return yield* _effect_platform__WEBPACK_IMPORTED_MODULE_16__.json(routerConfig);\n        });\n        const POST = effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n            const { \"uploadthing-hook\": uploadthingHook, \"x-uploadthing-package\": fePackage, \"x-uploadthing-version\": clientVersion } = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_17__.schemaHeaders(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.Struct({\n                \"uploadthing-hook\": UploadThingHook.pipe(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.optional),\n                \"x-uploadthing-package\": _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.String.pipe(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.optionalWith({\n                    default: ()=>\"unknown\"\n                })),\n                \"x-uploadthing-version\": _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.String.pipe(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.optionalWith({\n                    default: ()=>version\n                }))\n            }));\n            if (clientVersion !== version) {\n                const msg = `Server version: ${version}, Client version: ${clientVersion}`;\n                yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logError(msg);\n                return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                    code: \"BAD_REQUEST\",\n                    message: \"Client version mismatch\",\n                    cause: msg\n                });\n            }\n            const { slug, actionType } = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_18__.schemaParams(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.Struct({\n                actionType: ActionType.pipe(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.optional),\n                slug: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.String\n            }));\n            const uploadable = opts.router[slug];\n            if (!uploadable) {\n                const msg = `No file route found for slug ${slug}`;\n                yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logError(msg);\n                return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                    code: \"NOT_FOUND\",\n                    message: msg\n                });\n            }\n            const { body, fiber } = yield* effect_Match__WEBPACK_IMPORTED_MODULE_19__.value({\n                actionType,\n                uploadthingHook\n            }).pipe(effect_Match__WEBPACK_IMPORTED_MODULE_19__.when({\n                actionType: \"upload\",\n                uploadthingHook: undefined\n            }, ()=>handleUploadAction({\n                    uploadable,\n                    fePackage,\n                    beAdapter,\n                    slug\n                })), effect_Match__WEBPACK_IMPORTED_MODULE_19__.when({\n                actionType: undefined,\n                uploadthingHook: \"callback\"\n            }, ()=>handleCallbackRequest({\n                    uploadable,\n                    fePackage,\n                    beAdapter\n                })), effect_Match__WEBPACK_IMPORTED_MODULE_19__.when({\n                actionType: undefined,\n                uploadthingHook: \"error\"\n            }, ()=>handleErrorRequest({\n                    uploadable\n                })), effect_Match__WEBPACK_IMPORTED_MODULE_19__.orElse(()=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.succeed({\n                    body: null,\n                    fiber: null\n                })));\n            if (fiber) {\n                yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Running fiber as daemon\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"handleDaemon\", handleDaemon));\n                if (handleDaemon === \"void\") ; else if (handleDaemon === \"await\") {\n                    yield* fiber.await;\n                } else if (typeof handleDaemon === \"function\") {\n                    handleDaemon(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.runPromise(fiber.await));\n                }\n            }\n            yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Sending response\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"body\", body));\n            return yield* _effect_platform__WEBPACK_IMPORTED_MODULE_16__.json(body);\n        }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.catchTags({\n            ParseError: (e)=>_effect_platform__WEBPACK_IMPORTED_MODULE_16__.json(formatError(new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                    code: \"BAD_REQUEST\",\n                    message: \"Invalid input\",\n                    cause: e.message\n                }), opts.router), {\n                    status: 400\n                }),\n            UploadThingError: (e)=>// eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n                _effect_platform__WEBPACK_IMPORTED_MODULE_16__.json(formatError(e, opts.router), {\n                    status: (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.getStatusCodeFromError)(e)\n                })\n        }));\n        const appendResponseHeaders = effect_Effect__WEBPACK_IMPORTED_MODULE_5__.map(_effect_platform__WEBPACK_IMPORTED_MODULE_16__.setHeader(\"x-uploadthing-version\", version));\n        return _effect_platform__WEBPACK_IMPORTED_MODULE_18__.empty.pipe(_effect_platform__WEBPACK_IMPORTED_MODULE_18__.get(\"*\", GET), _effect_platform__WEBPACK_IMPORTED_MODULE_18__.post(\"*\", POST), _effect_platform__WEBPACK_IMPORTED_MODULE_18__.use(appendResponseHeaders));\n    }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.withLogSpan(\"createRequestHandler\"));\nconst handleErrorRequest = (opts)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n        const { uploadable } = opts;\n        const request = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_17__.HttpServerRequest;\n        const { apiKey } = yield* UTToken;\n        const verified = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.verifySignature)((yield* request.text), request.headers[\"x-uploadthing-signature\"], apiKey);\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(`Signature verified: ${verified}`);\n        if (!verified) {\n            yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logError(\"Invalid signature\");\n            return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                code: \"BAD_REQUEST\",\n                message: \"Invalid signature\"\n            });\n        }\n        const requestInput = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_17__.schemaBodyJson(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.Struct({\n            fileKey: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n            error: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.String\n        }));\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Handling error callback request with input:\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"json\", requestInput));\n        const fiber = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tryPromise({\n            try: async ()=>uploadable._def.onUploadError({\n                    error: new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                        code: \"UPLOAD_FAILED\",\n                        message: `Upload failed for ${requestInput.fileKey}: ${requestInput.error}`\n                    }),\n                    fileKey: requestInput.fileKey\n                }),\n            catch: (error)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                    code: \"INTERNAL_SERVER_ERROR\",\n                    message: \"Failed to run onUploadError\",\n                    cause: error\n                })\n        }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tapError((error)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logError(\"Failed to run onUploadError. You probably shouldn't be throwing errors here.\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"error\", error)))).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.ignoreLogged, effect_Effect__WEBPACK_IMPORTED_MODULE_5__.forkDaemon);\n        return {\n            body: null,\n            fiber\n        };\n    }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.withLogSpan(\"handleErrorRequest\"));\nconst handleCallbackRequest = (opts)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n        const { uploadable, fePackage, beAdapter } = opts;\n        const request = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_17__.HttpServerRequest;\n        const { apiKey } = yield* UTToken;\n        const verified = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.verifySignature)((yield* request.text), request.headers[\"x-uploadthing-signature\"], apiKey);\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(`Signature verified: ${verified}`);\n        if (!verified) {\n            yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logError(\"Invalid signature\");\n            return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                code: \"BAD_REQUEST\",\n                message: \"Invalid signature\"\n            });\n        }\n        const requestInput = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_17__.schemaBodyJson(_effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.Struct({\n            status: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n            file: UploadedFileData,\n            metadata: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.Record({\n                key: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n                value: _effect_schema_Schema__WEBPACK_IMPORTED_MODULE_1__.Unknown\n            })\n        }));\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Handling callback request with input:\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"json\", requestInput));\n        /**\n     * Run `.onUploadComplete` as a daemon to prevent the\n     * request from UT to potentially timeout.\n     */ const fiber = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n            const serverData = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tryPromise({\n                try: async ()=>uploadable.resolver({\n                        file: requestInput.file,\n                        metadata: requestInput.metadata\n                    }),\n                catch: (error)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                        code: \"INTERNAL_SERVER_ERROR\",\n                        message: \"Failed to run onUploadComplete. You probably shouldn't be throwing errors here.\",\n                        cause: error\n                    })\n            });\n            const payload = {\n                fileKey: requestInput.file.key,\n                callbackData: serverData ?? null\n            };\n            yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"'onUploadComplete' callback finished. Sending response to UploadThing:\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"callbackData\", payload));\n            const baseUrl = yield* IngestUrl;\n            const httpClient = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_13__.HttpClient;\n            yield* _effect_platform__WEBPACK_IMPORTED_MODULE_20__.post(`/callback-result`).pipe(_effect_platform__WEBPACK_IMPORTED_MODULE_20__.prependUrl(baseUrl), _effect_platform__WEBPACK_IMPORTED_MODULE_20__.setHeaders({\n                \"x-uploadthing-api-key\": apiKey,\n                \"x-uploadthing-version\": version,\n                \"x-uploadthing-be-adapter\": beAdapter,\n                \"x-uploadthing-fe-package\": fePackage\n            }), _effect_platform__WEBPACK_IMPORTED_MODULE_20__.jsonBody(payload), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.flatMap(_effect_platform__WEBPACK_IMPORTED_MODULE_13__.filterStatusOk(httpClient)), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tapErrorTag(\"ResponseError\", ({ response: res })=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.flatMap(res.json, (json)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logError(`Failed to register callback result (${res.status})`).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"error\", json)))), _effect_platform__WEBPACK_IMPORTED_MODULE_21__.schemaBodyJsonScoped(CallbackResultResponse), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tap(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.log(\"Sent callback result to UploadThing\")));\n        }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.ignoreLogged, effect_Effect__WEBPACK_IMPORTED_MODULE_5__.forkDaemon);\n        return {\n            body: null,\n            fiber\n        };\n    }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.withLogSpan(\"handleCallbackRequest\"));\nconst runRouteMiddleware = (opts)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n        const middlewareArgs = yield* MiddlewareArguments;\n        const { json: { files, input }, uploadable } = opts;\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Running middleware\");\n        const metadata = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tryPromise({\n            try: async ()=>uploadable._def.middleware({\n                    ...middlewareArgs,\n                    input,\n                    files\n                }),\n            catch: (error)=>error instanceof _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError ? error : new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                    code: \"INTERNAL_SERVER_ERROR\",\n                    message: \"Failed to run middleware\",\n                    cause: error\n                })\n        });\n        if (metadata[_internal_types_js__WEBPACK_IMPORTED_MODULE_0__.UTFiles] && metadata[_internal_types_js__WEBPACK_IMPORTED_MODULE_0__.UTFiles].length !== files.length) {\n            const msg = `Expected files override to have the same length as original files, got ${metadata[_internal_types_js__WEBPACK_IMPORTED_MODULE_0__.UTFiles].length} but expected ${files.length}`;\n            yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logError(msg);\n            return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                code: \"BAD_REQUEST\",\n                message: \"Files override must have the same length as files\",\n                cause: msg\n            });\n        }\n        // Attach customIds from middleware to the files\n        const filesWithCustomIds = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.forEach(files, (file, idx)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n                const theirs = metadata[_internal_types_js__WEBPACK_IMPORTED_MODULE_0__.UTFiles]?.[idx];\n                if (theirs && theirs.size !== file.size) {\n                    yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logWarning(\"File size mismatch. Reverting to original size\");\n                }\n                return {\n                    name: theirs?.name ?? file.name,\n                    size: file.size,\n                    type: file.type,\n                    customId: theirs?.customId,\n                    lastModified: theirs?.lastModified ?? Date.now()\n                };\n            }));\n        return {\n            metadata,\n            filesWithCustomIds\n        };\n    }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.withLogSpan(\"runRouteMiddleware\"));\nconst handleUploadAction = (opts)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n        const httpClient = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_13__.HttpClient;\n        const { uploadable, fePackage, beAdapter, slug } = opts;\n        const json = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_17__.schemaBodyJson(UploadActionPayload);\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Handling upload request\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"json\", json));\n        // validate the input\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Parsing user input\");\n        const inputParser = uploadable._def.inputParser;\n        const parsedInput = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tryPromise({\n            try: async ()=>getParseFn(inputParser)(json.input),\n            catch: (error)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                    code: \"BAD_REQUEST\",\n                    message: \"Invalid input\",\n                    cause: error\n                })\n        });\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Input parsed successfully\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"input\", parsedInput));\n        const { metadata, filesWithCustomIds } = yield* runRouteMiddleware({\n            json: {\n                input: parsedInput,\n                files: json.files\n            },\n            uploadable\n        });\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Parsing route config\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"routerConfig\", uploadable._def.routerConfig));\n        const parsedConfig = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.fillInputRouteConfig)(uploadable._def.routerConfig).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.catchTag(\"InvalidRouteConfig\", (err)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                code: \"BAD_REQUEST\",\n                message: \"Invalid route config\",\n                cause: err\n            })));\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Route config parsed successfully\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"routeConfig\", parsedConfig));\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Validating files meet the config requirements\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"files\", json.files));\n        yield* assertFilesMeetConfig(json.files, parsedConfig).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.mapError((e)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                code: \"BAD_REQUEST\",\n                message: `Invalid config: ${e._tag}`,\n                cause: \"reason\" in e ? e.reason : e.message\n            })));\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Files validated.\");\n        const fileUploadRequests = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.forEach(filesWithCustomIds, (file)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.map((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.getTypeFromFileName)(file.name, (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.objectKeys)(parsedConfig)), (type)=>({\n                    name: file.name,\n                    size: file.size,\n                    type: file.type,\n                    lastModified: file.lastModified,\n                    customId: file.customId,\n                    contentDisposition: parsedConfig[type]?.contentDisposition ?? \"inline\",\n                    acl: parsedConfig[type]?.acl\n                }))).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.catchTags({\n            /** Shouldn't happen since config is validated above so just dying is fine I think */ InvalidFileType: (e)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.die(e),\n            UnknownFileType: (e)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.die(e)\n        }));\n        const routeOptions = uploadable._def.routeOptions;\n        const { apiKey, appId } = yield* UTToken;\n        const ingestUrl = yield* IngestUrl;\n        const isDev = yield* IsDevelopment;\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Generating presigned URLs\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"fileUploadRequests\", fileUploadRequests), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"ingestUrl\", ingestUrl));\n        const presignedUrls = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.forEach(fileUploadRequests, (file)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n                const key = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.generateKey)(file, appId, routeOptions.getFileHashParts);\n                const url = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.generateSignedURL)(`${ingestUrl}/${key}`, apiKey, {\n                    ttlInSeconds: routeOptions.presignedURLTTL,\n                    data: {\n                        \"x-ut-identifier\": appId,\n                        \"x-ut-file-name\": file.name,\n                        \"x-ut-file-size\": file.size,\n                        \"x-ut-file-type\": file.type,\n                        \"x-ut-slug\": slug,\n                        \"x-ut-custom-id\": file.customId,\n                        \"x-ut-content-disposition\": file.contentDisposition,\n                        \"x-ut-acl\": file.acl\n                    }\n                });\n                return {\n                    url,\n                    key\n                };\n            }), {\n            concurrency: \"unbounded\"\n        });\n        const serverReq = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_17__.HttpServerRequest;\n        const requestUrl = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_17__.toURL(serverReq);\n        const devHookRequest = yield* effect_Config__WEBPACK_IMPORTED_MODULE_4__.string(\"callbackUrl\").pipe(effect_Config__WEBPACK_IMPORTED_MODULE_4__.withDefault(requestUrl.origin + requestUrl.pathname), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.map((url)=>_effect_platform__WEBPACK_IMPORTED_MODULE_20__.post(url).pipe(_effect_platform__WEBPACK_IMPORTED_MODULE_20__.appendUrlParam(\"slug\", slug))));\n        const metadataRequest = _effect_platform__WEBPACK_IMPORTED_MODULE_20__.post(\"/route-metadata\").pipe(_effect_platform__WEBPACK_IMPORTED_MODULE_20__.prependUrl(ingestUrl), _effect_platform__WEBPACK_IMPORTED_MODULE_20__.setHeaders({\n            \"x-uploadthing-api-key\": apiKey,\n            \"x-uploadthing-version\": version,\n            \"x-uploadthing-be-adapter\": beAdapter,\n            \"x-uploadthing-fe-package\": fePackage\n        }), _effect_platform__WEBPACK_IMPORTED_MODULE_20__.jsonBody({\n            fileKeys: presignedUrls.map(({ key })=>key),\n            metadata: metadata,\n            isDev,\n            callbackUrl: devHookRequest.url,\n            callbackSlug: slug,\n            awaitServerData: routeOptions.awaitServerData ?? true\n        }), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.flatMap(_effect_platform__WEBPACK_IMPORTED_MODULE_13__.filterStatusOk(httpClient)), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tapBoth({\n            onSuccess: (res)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Registerred metadata\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"response\", res)),\n            onFailure: (err)=>err._tag === \"ResponseError\" ? effect_Effect__WEBPACK_IMPORTED_MODULE_5__.flatMap(err.response.json, (json)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logError(`Failed to register metadata (${err.response.status})`).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"response\", err.response), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"json\", json))) : effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logError(\"Failed to register metadata\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"error\", err))\n        }));\n        // Send metadata to UT server (non blocking as a daemon)\n        // In dev, keep the stream open and simulate the callback requests as\n        // files complete uploading\n        const fiber = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__[\"if\"](isDev, {\n            onTrue: ()=>metadataRequest.pipe(_effect_platform__WEBPACK_IMPORTED_MODULE_22__.stream, handleJsonLineStream(MetadataFetchStreamPart, ({ payload, signature, hook })=>devHookRequest.pipe(_effect_platform__WEBPACK_IMPORTED_MODULE_20__.setHeaders({\n                        \"uploadthing-hook\": hook,\n                        \"x-uploadthing-signature\": signature\n                    }), _effect_platform__WEBPACK_IMPORTED_MODULE_20__.setBody(_effect_platform__WEBPACK_IMPORTED_MODULE_23__.text(payload, \"application/json\")), httpClient, _effect_platform__WEBPACK_IMPORTED_MODULE_22__.arrayBuffer, effect_Effect__WEBPACK_IMPORTED_MODULE_5__.asVoid, effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tap(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.log(`Successfully simulated '${hook}' event`)), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.ignoreLogged))),\n            onFalse: ()=>metadataRequest.pipe(_effect_platform__WEBPACK_IMPORTED_MODULE_21__.schemaBodyJsonScoped(MetadataFetchResponse))\n        }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.forkDaemon);\n        const presigneds = presignedUrls.map((p, i)=>({\n                url: p.url,\n                key: p.key,\n                name: fileUploadRequests[i].name,\n                customId: fileUploadRequests[i].customId ?? null\n            }));\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logInfo(\"Sending presigned URLs to client\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"presignedUrls\", presigneds));\n        return {\n            body: presigneds,\n            fiber\n        };\n    }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.withLogSpan(\"handleUploadAction\"));\n\nfunction internalCreateBuilder(initDef = {}) {\n    const _def = {\n        // Default router config\n        routerConfig: {\n            image: {\n                maxFileSize: \"4MB\"\n            }\n        },\n        routeOptions: {\n            awaitServerData: true\n        },\n        inputParser: {\n            parse: ()=>undefined,\n            _input: undefined,\n            _output: undefined\n        },\n        middleware: ()=>({}),\n        onUploadError: ()=>{\n        // noop\n        },\n        errorFormatter: initDef.errorFormatter ?? defaultErrorFormatter,\n        // Overload with properties passed in\n        ...initDef\n    };\n    return {\n        input (userParser) {\n            return internalCreateBuilder({\n                ..._def,\n                inputParser: userParser\n            });\n        },\n        middleware (userMiddleware) {\n            return internalCreateBuilder({\n                ..._def,\n                middleware: userMiddleware\n            });\n        },\n        onUploadComplete (userUploadComplete) {\n            return {\n                _def,\n                resolver: userUploadComplete\n            };\n        },\n        onUploadError (userOnUploadError) {\n            return internalCreateBuilder({\n                ..._def,\n                onUploadError: userOnUploadError\n            });\n        }\n    };\n}\nfunction createBuilder(opts) {\n    return (input, config)=>{\n        return internalCreateBuilder({\n            routerConfig: input,\n            routeOptions: config ?? {},\n            ...opts\n        });\n    };\n}\n\nconst createUploadthing = (opts)=>createBuilder(opts);\nconst createRouteHandler = (opts)=>{\n    const handler = makeAdapterHandler((req)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.succeed({\n            req,\n            res: undefined,\n            event: undefined\n        }), (req)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.succeed(req), opts, \"nextjs-app\");\n    return {\n        POST: handler,\n        GET: handler\n    };\n};\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvdXBsb2FkdGhpbmcvbmV4dC9pbmRleC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBd0M7QUFDbUg7QUFDaEg7QUFDRDtBQUNGO0FBQ0U7QUFDSjtBQUNrQjtBQUNsQjtBQUM0UTtBQUMxUDtBQUNoQjtBQUNBO0FBQ0k7QUFDUjtBQUNXO0FBQ0E7O0FBRS9DOztBQUVBLDBEQUFTLElBQUkseUVBQXdCO0FBQ3JDLDBEQUFTLElBQUksMERBQVM7QUFDdEI7QUFDQTtBQUNBLHVCQUF1QiwwREFBUztBQUNoQztBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsMERBQVM7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUIsNERBQVcsQ0FBQyxxRUFBb0IsRUFBRSx5REFBUTtBQUNuRTtBQUNBO0FBQ0EsQ0FBQztBQUNELG9CQUFvQix5REFBUTtBQUM1QixZQUFZLHlEQUFRLE1BQU0sNkRBQVk7QUFDdEMsV0FBVyx5REFBUTtBQUNuQixhQUFhLGdFQUFlLENBQUMseURBQVE7QUFDckMsZ0JBQWdCLHlEQUFRLE1BQU0sK0RBQWM7QUFDNUM7QUFDQSxLQUFLO0FBQ0wsQ0FBQztBQUNELHlCQUF5Qix1RUFBc0IsTUFBTSwwREFBUyxnQkFBZ0IsMERBQVMsQ0FBQyw0REFBVztBQUNuRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUMsd0RBQU87QUFDeEMsVUFBVSx5REFBUTtBQUNsQixVQUFVLHlEQUFRO0FBQ2xCLFVBQVUseURBQVE7QUFDbEIsa0JBQWtCLHlEQUFRLE1BQU0sMkRBQVU7QUFDMUMsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYyx5REFBUSxDQUFDLHlEQUFRO0FBQy9CLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVMseURBQVE7QUFDakIsU0FBUyx5REFBUTtBQUNqQixZQUFZLHlEQUFRO0FBQ3BCLENBQUM7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eHQvaW5kZXguanM/ZmJiMCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBFZmZlY3QgZnJvbSAnZWZmZWN0L0VmZmVjdCc7XG5pbXBvcnQgeyBIdHRwQ2xpZW50LCBIdHRwQXBwLCBIdHRwU2VydmVyUmVzcG9uc2UsIEh0dHBTZXJ2ZXJSZXF1ZXN0LCBIdHRwUm91dGVyLCBIdHRwQ2xpZW50UmVxdWVzdCwgSHR0cENsaWVudFJlc3BvbnNlLCBIdHRwQm9keSB9IGZyb20gJ0BlZmZlY3QvcGxhdGZvcm0nO1xuaW1wb3J0ICogYXMgUyBmcm9tICdAZWZmZWN0L3NjaGVtYS9TY2hlbWEnO1xuaW1wb3J0IHsgUHJldHR5TG9nZ2VyIH0gZnJvbSAnZWZmZWN0LWxvZyc7XG5pbXBvcnQgKiBhcyBDb25maWcgZnJvbSAnZWZmZWN0L0NvbmZpZyc7XG5pbXBvcnQgKiBhcyBDb250ZXh0IGZyb20gJ2VmZmVjdC9Db250ZXh0JztcbmltcG9ydCAqIGFzIExheWVyIGZyb20gJ2VmZmVjdC9MYXllcic7XG5pbXBvcnQgKiBhcyBNYW5hZ2VkUnVudGltZSBmcm9tICdlZmZlY3QvTWFuYWdlZFJ1bnRpbWUnO1xuaW1wb3J0ICogYXMgTWF0Y2ggZnJvbSAnZWZmZWN0L01hdGNoJztcbmltcG9ydCB7IFZhbGlkQ29udGVudERpc3Bvc2l0aW9ucywgVmFsaWRBQ0xzLCBmaWx0ZXJEZWZpbmVkT2JqZWN0VmFsdWVzLCBVcGxvYWRUaGluZ0Vycm9yLCBnZXRUeXBlRnJvbUZpbGVOYW1lLCBvYmplY3RLZXlzLCBJbnZhbGlkUm91dGVDb25maWdFcnJvciwgZmlsZVNpemVUb0J5dGVzLCBmaWxsSW5wdXRSb3V0ZUNvbmZpZywgYnl0ZXNUb0ZpbGVTaXplLCBnZXRTdGF0dXNDb2RlRnJvbUVycm9yLCB2ZXJpZnlTaWduYXR1cmUsIGdlbmVyYXRlS2V5LCBnZW5lcmF0ZVNpZ25lZFVSTCB9IGZyb20gJ0B1cGxvYWR0aGluZy9zaGFyZWQnO1xuaW1wb3J0ICogYXMgQ29uZmlnUHJvdmlkZXIgZnJvbSAnZWZmZWN0L0NvbmZpZ1Byb3ZpZGVyJztcbmltcG9ydCAqIGFzIFN0cmVhbSBmcm9tICdlZmZlY3QvU3RyZWFtJztcbmltcG9ydCAqIGFzIExvZ2dlciBmcm9tICdlZmZlY3QvTG9nZ2VyJztcbmltcG9ydCAqIGFzIExvZ0xldmVsIGZyb20gJ2VmZmVjdC9Mb2dMZXZlbCc7XG5pbXBvcnQgKiBhcyBEYXRhIGZyb20gJ2VmZmVjdC9EYXRhJztcbmltcG9ydCB7IFVURmlsZXMgfSBmcm9tICcuLi9pbnRlcm5hbC90eXBlcy5qcyc7XG5leHBvcnQgeyBVVEZpbGVzIH0gZnJvbSAnLi4vaW50ZXJuYWwvdHlwZXMuanMnO1xuXG52YXIgdmVyc2lvbiA9IFwiNy4wLjJcIjtcblxuUy5MaXRlcmFsKC4uLlZhbGlkQ29udGVudERpc3Bvc2l0aW9ucyk7XG5TLkxpdGVyYWwoLi4uVmFsaWRBQ0xzKTtcbi8qKlxuICogVmFsaWQgb3B0aW9ucyBmb3IgdGhlIGA/YWN0aW9uVHlwZWAgcXVlcnkgcGFyYW1cbiAqLyBjb25zdCBBY3Rpb25UeXBlID0gUy5MaXRlcmFsKFwidXBsb2FkXCIpO1xuLyoqXG4gKiBWYWxpZCBvcHRpb25zIGZvciB0aGUgYHVwbG9hZHRoaW5nLWhvb2tgIGhlYWRlclxuICogZm9yIHJlcXVlc3RzIGNvbWluZyBmcm9tIFVUIHNlcnZlclxuICovIGNvbnN0IFVwbG9hZFRoaW5nSG9vayA9IFMuTGl0ZXJhbChcImNhbGxiYWNrXCIsIFwiZXJyb3JcIik7XG4vKipcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT0gQ29uZmlndXJhdGlvbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqLyBjb25zdCBEZWNvZGVTdHJpbmcgPSBTLnRyYW5zZm9ybShTLlVpbnQ4QXJyYXlGcm9tU2VsZiwgUy5TdHJpbmcsIHtcbiAgICBkZWNvZGU6IChkYXRhKT0+bmV3IFRleHREZWNvZGVyKCkuZGVjb2RlKGRhdGEpLFxuICAgIGVuY29kZTogKGRhdGEpPT5uZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoZGF0YSlcbn0pO1xuY29uc3QgUGFyc2VkVG9rZW4gPSBTLlN0cnVjdCh7XG4gICAgYXBpS2V5OiBTLlN0cmluZy5waXBlKFMuc3RhcnRzV2l0aChcInNrX1wiKSksXG4gICAgYXBwSWQ6IFMuU3RyaW5nLFxuICAgIHJlZ2lvbnM6IFMuTm9uRW1wdHlBcnJheShTLlN0cmluZyksXG4gICAgaW5nZXN0SG9zdDogUy5TdHJpbmcucGlwZShTLm9wdGlvbmFsV2l0aCh7XG4gICAgICAgIGRlZmF1bHQ6ICgpPT5cImluZ2VzdC51cGxvYWR0aGluZy5jb21cIlxuICAgIH0pKVxufSk7XG5jb25zdCBVcGxvYWRUaGluZ1Rva2VuID0gUy5VaW50OEFycmF5RnJvbUJhc2U2NC5waXBlKFMuY29tcG9zZShEZWNvZGVTdHJpbmcpLCBTLmNvbXBvc2UoUy5wYXJzZUpzb24oUGFyc2VkVG9rZW4pKSk7XG4vKipcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT0gRmlsZSBUeXBlIEhpZXJhcmNoeSA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICovIC8qKlxuICogUHJvcGVydGllcyBmcm9tIHRoZSB3ZWIgRmlsZSBvYmplY3QsIHRoaXMgaXMgd2hhdCB0aGUgY2xpZW50IHNlbmRzIHdoZW4gaW5pdGlhdGluZyBhbiB1cGxvYWRcbiAqLyBjbGFzcyBGaWxlVXBsb2FkRGF0YSBleHRlbmRzIFMuQ2xhc3MoXCJGaWxlVXBsb2FkRGF0YVwiKSh7XG4gICAgbmFtZTogUy5TdHJpbmcsXG4gICAgc2l6ZTogUy5OdW1iZXIsXG4gICAgdHlwZTogUy5TdHJpbmcsXG4gICAgbGFzdE1vZGlmaWVkOiBTLk51bWJlci5waXBlKFMub3B0aW9uYWwpXG59KSB7XG59XG4vKipcbiAqIGAubWlkZGxld2FyZSgpYCBjYW4gYWRkIGEgY3VzdG9tSWQgdG8gdGhlIGluY29taW5nIGZpbGUgZGF0YVxuICovIGNsYXNzIEZpbGVVcGxvYWREYXRhV2l0aEN1c3RvbUlkIGV4dGVuZHMgRmlsZVVwbG9hZERhdGEuZXh0ZW5kKFwiRmlsZVVwbG9hZERhdGFXaXRoQ3VzdG9tSWRcIikoe1xuICAgIGN1c3RvbUlkOiBTLk51bGxPcihTLlN0cmluZylcbn0pIHtcbn1cbi8qKlxuICogV2hlbiBmaWxlcyBhcmUgdXBsb2FkZWQsIHdlIGdldCBiYWNrXG4gKiAtIGEga2V5XG4gKiAtIGEgZGlyZWN0IFVSTCBmb3IgdGhlIGZpbGVcbiAqIC0gYW4gYXBwLXNwZWNpZmljIFVSTCBmb3IgdGhlIGZpbGUgKHVzZWZ1bCBmb3Igc2NvcGluZyBlZy4gZm9yIG9wdGltaXphdGlvbiBhbGxvd2VkIG9yaWdpbnMpXG4gKi8gY2xhc3MgVXBsb2FkZWRGaWxlRGF0YSBleHRlbmRzIEZpbGVVcGxvYWREYXRhV2l0aEN1c3RvbUlkLmV4dGVuZChcIlVwbG9hZGVkRmlsZURhdGFcIikoe1xuICAgIGtleTogUy5TdHJpbmcsXG4gICAgdXJsOiBTLlN0cmluZyxcbiAgICBhcHBVcmw6IFMuU3RyaW5nXG59KSB7XG59XG4vKipcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT0gU2VydmVyIFJlc3BvbnNlIFNjaGVtYXMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqLyBjbGFzcyBOZXdQcmVzaWduZWRVcmwgZXh0ZW5kcyBTLkNsYXNzKFwiTmV3UHJlc2lnbmVkVXJsXCIpKHtcbiAgICB1cmw6IFMuU3RyaW5nLFxuICAgIGtleTogUy5TdHJpbmcsXG4gICAgY3VzdG9tSWQ6IFMuTnVsbE9yKFMuU3RyaW5nKSxcbiAgICBuYW1lOiBTLlN0cmluZ1xufSkge1xufVxuY2xhc3MgTWV0YWRhdGFGZXRjaFN0cmVhbVBhcnQgZXh0ZW5kcyBTLkNsYXNzKFwiTWV0YWRhdGFGZXRjaFN0cmVhbVBhcnRcIikoe1xuICAgIHBheWxvYWQ6IFMuU3RyaW5nLFxuICAgIHNpZ25hdHVyZTogUy5TdHJpbmcsXG4gICAgaG9vazogVXBsb2FkVGhpbmdIb29rXG59KSB7XG59XG5jbGFzcyBNZXRhZGF0YUZldGNoUmVzcG9uc2UgZXh0ZW5kcyBTLkNsYXNzKFwiTWV0YWRhdGFGZXRjaFJlc3BvbnNlXCIpKHtcbiAgICBvazogUy5Cb29sZWFuXG59KSB7XG59XG5jbGFzcyBDYWxsYmFja1Jlc3VsdFJlc3BvbnNlIGV4dGVuZHMgUy5DbGFzcyhcIkNhbGxiYWNrUmVzdWx0UmVzcG9uc2VcIikoe1xuICAgIG9rOiBTLkJvb2xlYW5cbn0pIHtcbn1cbi8qKlxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqID09PT09PT09PT09PT09PT09PT09PT09PSBDbGllbnQgQWN0aW9uIFBheWxvYWRzID09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKi8gY2xhc3MgVXBsb2FkQWN0aW9uUGF5bG9hZCBleHRlbmRzIFMuQ2xhc3MoXCJVcGxvYWRBY3Rpb25QYXlsb2FkXCIpKHtcbiAgICBmaWxlczogUy5BcnJheShGaWxlVXBsb2FkRGF0YSksXG4gICAgaW5wdXQ6IFMuVW5rbm93blxufSkge1xufVxuXG4vKipcbiAqIE1lcmdlIGluIGBpbXBvcnQubWV0YS5lbnZgIHRvIHRoZSBidWlsdC1pbiBgcHJvY2Vzcy5lbnZgIHByb3ZpZGVyXG4gKiBQcmVmaXgga2V5cyB3aXRoIGBVUExPQURUSElOR19gIHNvIHdlIGNhbiByZWZlcmVuY2UganVzdCB0aGUgbmFtZS5cbiAqIEBleGFtcGxlXG4gKiBwcm9jZXNzLmVudi5VUExPQURUSElOR19UT0tFTiA9IFwiZm9vXCJcbiAqIENvbmZpZy5zdHJpbmcoXCJ0b2tlblwiKTsgLy8gQ29uZmlnPFwiZm9vXCI+XG4gKi8gY29uc3QgZW52UHJvdmlkZXIgPSBDb25maWdQcm92aWRlci5mcm9tRW52KCkucGlwZShDb25maWdQcm92aWRlci5vckVsc2UoKCk9PkNvbmZpZ1Byb3ZpZGVyLmZyb21NYXAobmV3IE1hcChPYmplY3QuZW50cmllcyhmaWx0ZXJEZWZpbmVkT2JqZWN0VmFsdWVzKC8vIGZ1Y2sgdGhpcyBJIGdpdmUgdXAuIGltcG9ydC5tZXRhIGlzIGEgbWlzdGFrZSwgc29tZW9uZSBlbHNlIGNhbiBmaXggaXRcbiAgICBpbXBvcnQubWV0YT8uZW52ID8/IHt9KSkpLCB7XG4gICAgICAgIHBhdGhEZWxpbTogXCJfXCJcbiAgICB9KSksIENvbmZpZ1Byb3ZpZGVyLm5lc3RlZChcInVwbG9hZHRoaW5nXCIpLCBDb25maWdQcm92aWRlci5jb25zdGFudENhc2UpO1xuLyoqXG4gKiBDb25maWcgcHJvdmlkZXIgdGhhdCBtZXJnZXMgdGhlIG9wdGlvbnMgZnJvbSB0aGUgb2JqZWN0XG4gKiBhbmQgZW52aXJvbm1lbnQgdmFyaWFibGVzIHByZWZpeGVkIHdpdGggYFVQTE9BRFRISU5HX2AuXG4gKiBAcmVtYXJrcyBPcHRpb25zIHRha2UgcHJlY2VkZW5jZSBvdmVyIGVudmlyb25tZW50IHZhcmlhYmxlcy5cbiAqLyBjb25zdCBjb25maWdQcm92aWRlciA9IChvcHRpb25zKT0+Q29uZmlnUHJvdmlkZXIuZnJvbUpzb24ob3B0aW9ucyA/PyB7fSkucGlwZShDb25maWdQcm92aWRlci5vckVsc2UoKCk9PmVudlByb3ZpZGVyKSk7XG5jb25zdCBJc0RldmVsb3BtZW50ID0gQ29uZmlnLmJvb2xlYW4oXCJpc0RldlwiKS5waXBlKENvbmZpZy5vckVsc2UoKCk9PkNvbmZpZy5zdWNjZWVkKHR5cGVvZiBwcm9jZXNzICE9PSBcInVuZGVmaW5lZFwiID8gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgOiB1bmRlZmluZWQpLnBpcGUoQ29uZmlnLm1hcCgoXyk9Pl8gPT09IFwiZGV2ZWxvcG1lbnRcIikpKSwgQ29uZmlnLndpdGhEZWZhdWx0KGZhbHNlKSk7XG5jb25zdCBVVFRva2VuID0gUy5Db25maWcoXCJ0b2tlblwiLCBVcGxvYWRUaGluZ1Rva2VuKS5waXBlKEVmZmVjdC5jYXRjaFRhZ3Moe1xuICAgIENvbmZpZ0Vycm9yOiAoZSk9Pm5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgIGNvZGU6IGUuX29wID09PSBcIkludmFsaWREYXRhXCIgPyBcIklOVkFMSURfU0VSVkVSX0NPTkZJR1wiIDogXCJNSVNTSU5HX0VOVlwiLFxuICAgICAgICAgICAgbWVzc2FnZTogZS5fb3AgPT09IFwiSW52YWxpZERhdGFcIiA/IFwiSW52YWxpZCB0b2tlbi4gQSB0b2tlbiBpcyBhIGJhc2U2NCBlbmNvZGVkIEpTT04gb2JqZWN0IG1hdGNoaW5nIHsgYXBpS2V5OiBzdHJpbmcsIGFwcElkOiBzdHJpbmcsIHJlZ2lvbnM6IHN0cmluZ1tdIH0uXCIgOiBcIk1pc3NpbmcgdG9rZW4uIFBsZWFzZSBzZXQgdGhlIGBVUExPQURUSElOR19UT0tFTmAgZW52aXJvbm1lbnQgdmFyaWFibGUgb3IgcHJvdmlkZSBhIHRva2VuIG1hbnVhbGx5IHRocm91Z2ggY29uZmlnLlwiLFxuICAgICAgICAgICAgY2F1c2U6IGVcbiAgICAgICAgfSlcbn0pKTtcbkNvbmZpZy5zdHJpbmcoXCJhcGlVcmxcIikucGlwZShDb25maWcud2l0aERlZmF1bHQoXCJodHRwczovL2FwaS51cGxvYWR0aGluZy5jb21cIiksIENvbmZpZy5tYXBBdHRlbXB0KChfKT0+bmV3IFVSTChfKSksIENvbmZpZy5tYXAoKHVybCk9PnVybC5ocmVmLnJlcGxhY2UoL1xcLyQvLCBcIlwiKSkpO1xuY29uc3QgSW5nZXN0VXJsID0gRWZmZWN0LmdlbihmdW5jdGlvbiooKSB7XG4gICAgY29uc3QgeyByZWdpb25zLCBpbmdlc3RIb3N0IH0gPSB5aWVsZCogVVRUb2tlbjtcbiAgICBjb25zdCByZWdpb24gPSByZWdpb25zWzBdOyAvLyBDdXJyZW50bHkgb25seSBzdXBwb3J0IDEgcmVnaW9uIHBlciBhcHBcbiAgICByZXR1cm4geWllbGQqIENvbmZpZy5zdHJpbmcoXCJpbmdlc3RVcmxcIikucGlwZShDb25maWcud2l0aERlZmF1bHQoYGh0dHBzOi8vJHtyZWdpb259LiR7aW5nZXN0SG9zdH1gKSwgQ29uZmlnLm1hcEF0dGVtcHQoKF8pPT5uZXcgVVJMKF8pKSwgQ29uZmlnLm1hcCgodXJsKT0+dXJsLmhyZWYucmVwbGFjZSgvXFwvJC8sIFwiXCIpKSk7XG59KTtcblxuZnVuY3Rpb24gZGVmYXVsdEVycm9yRm9ybWF0dGVyKGVycm9yKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZVxuICAgIH07XG59XG5mdW5jdGlvbiBmb3JtYXRFcnJvcihlcnJvciwgcm91dGVyKSB7XG4gICAgY29uc3QgZXJyb3JGb3JtYXR0ZXIgPSByb3V0ZXJbT2JqZWN0LmtleXMocm91dGVyKVswXV0/Ll9kZWYuZXJyb3JGb3JtYXR0ZXIgPz8gZGVmYXVsdEVycm9yRm9ybWF0dGVyO1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW5zYWZlLXJldHVyblxuICAgIHJldHVybiBlcnJvckZvcm1hdHRlcihlcnJvcik7XG59XG5cbmNvbnN0IGhhbmRsZUpzb25MaW5lU3RyZWFtID0gKHNjaGVtYSwgb25DaHVuayk9PihzdHJlYW0pPT57XG4gICAgICAgIGxldCBidWYgPSBcIlwiO1xuICAgICAgICByZXR1cm4gc3RyZWFtLnBpcGUoU3RyZWFtLmRlY29kZVRleHQoKSwgU3RyZWFtLm1hcEVmZmVjdCgoY2h1bmspPT5FZmZlY3QuZ2VuKGZ1bmN0aW9uKigpIHtcbiAgICAgICAgICAgICAgICBidWYgKz0gY2h1bms7XG4gICAgICAgICAgICAgICAgLy8gU2NhbiBidWZmZXIgZm9yIG5ld2xpbmVzXG4gICAgICAgICAgICAgICAgY29uc3QgcGFydHMgPSBidWYuc3BsaXQoXCJcXG5cIik7XG4gICAgICAgICAgICAgICAgY29uc3QgdmFsaWRDaHVua3MgPSBbXTtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHBhcnQgb2YgcGFydHMpe1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQXR0ZW1wdCB0byBwYXJzZSBjaHVuayBhcyBKU09OXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWxpZENodW5rcy5wdXNoKEpTT04ucGFyc2UocGFydCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWR2YW5jZSBidWZmZXIgaWYgcGFyc2luZyBzdWNjZWVkZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ1ZiA9IGJ1Zi5zbGljZShwYXJ0Lmxlbmd0aCArIDEpO1xuICAgICAgICAgICAgICAgICAgICB9IGNhdGNoICB7XG4gICAgICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhcIlJlY2VpdmVkIGNodW5rc1wiKS5waXBlKEVmZmVjdC5hbm5vdGF0ZUxvZ3MoXCJjaHVua1wiLCBjaHVuayksIEVmZmVjdC5hbm5vdGF0ZUxvZ3MoXCJwYXJzZWRDaHVua3NcIiwgdmFsaWRDaHVua3MpLCBFZmZlY3QuYW5ub3RhdGVMb2dzKFwiYnVmXCIsIGJ1ZikpO1xuICAgICAgICAgICAgICAgIHJldHVybiB2YWxpZENodW5rcztcbiAgICAgICAgICAgIH0pKSwgU3RyZWFtLm1hcEVmZmVjdChTLmRlY29kZVVua25vd24oUy5BcnJheShzY2hlbWEpKSksIFN0cmVhbS5tYXBFZmZlY3QoRWZmZWN0LmZvckVhY2goKHBhcnQpPT5vbkNodW5rKHBhcnQpKSksIFN0cmVhbS5ydW5EcmFpbiwgRWZmZWN0LndpdGhMb2dTcGFuKFwiaGFuZGxlSnNvbkxpbmVTdHJlYW1cIikpO1xuICAgIH07XG5cbmNvbnN0IHdpdGhNaW5pbWFsTG9nTGV2ZWwgPSBDb25maWcubG9nTGV2ZWwoXCJsb2dMZXZlbFwiKS5waXBlKENvbmZpZy53aXRoRGVmYXVsdChMb2dMZXZlbC5JbmZvKSwgRWZmZWN0LmFuZFRoZW4oKGxldmVsKT0+TG9nZ2VyLm1pbmltdW1Mb2dMZXZlbChsZXZlbCkpLCBFZmZlY3QudGFwRXJyb3IoKGUpPT5FZmZlY3QubG9nRXJyb3IoXCJJbnZhbGlkIGxvZyBsZXZlbFwiKS5waXBlKEVmZmVjdC5hbm5vdGF0ZUxvZ3MoXCJlcnJvclwiLCBlKSkpLCBFZmZlY3QuY2F0Y2hUYWcoXCJDb25maWdFcnJvclwiLCAoZSk9Pm5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgY29kZTogXCJJTlZBTElEX1NFUlZFUl9DT05GSUdcIixcbiAgICAgICAgbWVzc2FnZTogXCJJbnZhbGlkIHNlcnZlciBjb25maWd1cmF0aW9uXCIsXG4gICAgICAgIGNhdXNlOiBlXG4gICAgfSkpLCBMYXllci51bndyYXBFZmZlY3QpO1xuXG5mdW5jdGlvbiBnZXRQYXJzZUZuKHBhcnNlcikge1xuICAgIGlmICh0eXBlb2YgcGFyc2VyLnBhcnNlID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgcmV0dXJuIHBhcnNlci5wYXJzZTtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBwYXJzZXJcIik7XG59XG5cbmNsYXNzIEZpbGVTaXplTWlzbWF0Y2ggZXh0ZW5kcyBEYXRhLkVycm9yIHtcbiAgICBjb25zdHJ1Y3Rvcih0eXBlLCBtYXgsIGFjdHVhbCl7XG4gICAgICAgIGNvbnN0IHJlYXNvbiA9IGBZb3UgdXBsb2FkZWQgYSAke3R5cGV9IGZpbGUgdGhhdCB3YXMgJHtieXRlc1RvRmlsZVNpemUoYWN0dWFsKX0sIGJ1dCB0aGUgbGltaXQgZm9yIHRoYXQgdHlwZSBpcyAke21heH1gO1xuICAgICAgICBzdXBlcih7XG4gICAgICAgICAgICByZWFzb25cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuX3RhZyA9IFwiRmlsZVNpemVNaXNtYXRjaFwiO1xuICAgICAgICB0aGlzLm5hbWUgPSBcIkZpbGVTaXplTWlzbWF0Y2hFcnJvclwiO1xuICAgIH1cbn1cbmNsYXNzIEZpbGVDb3VudE1pc21hdGNoIGV4dGVuZHMgRGF0YS5FcnJvciB7XG4gICAgY29uc3RydWN0b3IodHlwZSwgYm91bmR0eXBlLCBib3VuZCwgYWN0dWFsKXtcbiAgICAgICAgY29uc3QgcmVhc29uID0gYFlvdSB1cGxvYWRlZCAke2FjdHVhbH0gZmlsZShzKSBvZiB0eXBlICcke3R5cGV9JywgYnV0IHRoZSAke2JvdW5kdHlwZX0gZm9yIHRoYXQgdHlwZSBpcyAke2JvdW5kfWA7XG4gICAgICAgIHN1cGVyKHtcbiAgICAgICAgICAgIHJlYXNvblxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5fdGFnID0gXCJGaWxlQ291bnRNaXNtYXRjaFwiO1xuICAgICAgICB0aGlzLm5hbWUgPSBcIkZpbGVDb3VudE1pc21hdGNoRXJyb3JcIjtcbiAgICB9XG59XG4vLyBWZXJpZnkgdGhhdCB0aGUgdXBsb2FkZWQgZmlsZXMgZG9lc24ndCB2aW9sYXRlIHRoZSByb3V0ZSBjb25maWcsXG4vLyBlLmcuIHVwbG9hZGluZyBtb3JlIHZpZGVvcyB0aGFuIGFsbG93ZWQsIG9yIGEgZmlsZSB0aGF0IGlzIGxhcmdlciB0aGFuIGFsbG93ZWQuXG4vLyBUaGlzIGlzIGRvdWJsZS1jaGVja2VkIG9uIGluZnJhIHNpZGUsIGJ1dCB3ZSB3YW50IHRvIGZhaWwgZWFybHkgdG8gYXZvaWQgbmV0d29yayBsYXRlbmN5LlxuY29uc3QgYXNzZXJ0RmlsZXNNZWV0Q29uZmlnID0gKGZpbGVzLCByb3V0ZUNvbmZpZyk9PkVmZmVjdC5nZW4oZnVuY3Rpb24qKCkge1xuICAgICAgICBjb25zdCBjb3VudHMgPSB7fTtcbiAgICAgICAgZm9yIChjb25zdCBmaWxlIG9mIGZpbGVzKXtcbiAgICAgICAgICAgIGNvbnN0IHR5cGUgPSB5aWVsZCogZ2V0VHlwZUZyb21GaWxlTmFtZShmaWxlLm5hbWUsIG9iamVjdEtleXMocm91dGVDb25maWcpKTtcbiAgICAgICAgICAgIGNvdW50c1t0eXBlXSA9IChjb3VudHNbdHlwZV0gPz8gMCkgKyAxO1xuICAgICAgICAgICAgY29uc3Qgc2l6ZUxpbWl0ID0gcm91dGVDb25maWdbdHlwZV0/Lm1heEZpbGVTaXplO1xuICAgICAgICAgICAgaWYgKCFzaXplTGltaXQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geWllbGQqIG5ldyBJbnZhbGlkUm91dGVDb25maWdFcnJvcih0eXBlLCBcIm1heEZpbGVTaXplXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3Qgc2l6ZUxpbWl0Qnl0ZXMgPSB5aWVsZCogZmlsZVNpemVUb0J5dGVzKHNpemVMaW1pdCk7XG4gICAgICAgICAgICBpZiAoZmlsZS5zaXplID4gc2l6ZUxpbWl0Qnl0ZXMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geWllbGQqIG5ldyBGaWxlU2l6ZU1pc21hdGNoKHR5cGUsIHNpemVMaW1pdCwgZmlsZS5zaXplKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmb3IoY29uc3QgX2tleSBpbiBjb3VudHMpe1xuICAgICAgICAgICAgY29uc3Qga2V5ID0gX2tleTtcbiAgICAgICAgICAgIGNvbnN0IGNvbmZpZyA9IHJvdXRlQ29uZmlnW2tleV07XG4gICAgICAgICAgICBpZiAoIWNvbmZpZykgcmV0dXJuIHlpZWxkKiBuZXcgSW52YWxpZFJvdXRlQ29uZmlnRXJyb3Ioa2V5KTtcbiAgICAgICAgICAgIGNvbnN0IGNvdW50ID0gY291bnRzW2tleV07XG4gICAgICAgICAgICBjb25zdCBtaW4gPSBjb25maWcubWluRmlsZUNvdW50O1xuICAgICAgICAgICAgY29uc3QgbWF4ID0gY29uZmlnLm1heEZpbGVDb3VudDtcbiAgICAgICAgICAgIGlmIChtaW4gPiBtYXgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geWllbGQqIG5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgY29kZTogXCJCQURfUkVRVUVTVFwiLFxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBcIkludmFsaWQgY29uZmlnIGR1cmluZyBmaWxlIGNvdW50IC0gbWluRmlsZUNvdW50ID4gbWF4RmlsZUNvdW50XCIsXG4gICAgICAgICAgICAgICAgICAgIGNhdXNlOiBgbWluRmlsZUNvdW50IG11c3QgYmUgbGVzcyB0aGFuIG1heEZpbGVDb3VudCBmb3Iga2V5ICR7a2V5fS4gZ290OiAke21pbn0gPiAke21heH1gXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY291bnQgPCBtaW4pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geWllbGQqIG5ldyBGaWxlQ291bnRNaXNtYXRjaChrZXksIFwibWluaW11bVwiLCBtaW4sIGNvdW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjb3VudCA+IG1heCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB5aWVsZCogbmV3IEZpbGVDb3VudE1pc21hdGNoKGtleSwgXCJtYXhpbXVtXCIsIG1heCwgY291bnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH0pO1xuY29uc3QgZXh0cmFjdFJvdXRlckNvbmZpZyA9IChyb3V0ZXIpPT5FZmZlY3QuZm9yRWFjaChvYmplY3RLZXlzKHJvdXRlciksIChzbHVnKT0+RWZmZWN0Lm1hcChmaWxsSW5wdXRSb3V0ZUNvbmZpZyhyb3V0ZXJbc2x1Z10uX2RlZi5yb3V0ZXJDb25maWcpLCAoY29uZmlnKT0+KHtcbiAgICAgICAgICAgICAgICBzbHVnLFxuICAgICAgICAgICAgICAgIGNvbmZpZ1xuICAgICAgICAgICAgfSkpKTtcblxuY2xhc3MgTWlkZGxld2FyZUFyZ3VtZW50cyBleHRlbmRzIENvbnRleHQuVGFnKFwidXBsb2FkdGhpbmcvTWlkZGxld2FyZUFyZ3VtZW50c1wiKSgpIHtcbn1cbmNvbnN0IG1ha2VBZGFwdGVySGFuZGxlciA9IChtYWtlTWlkZGxld2FyZUFyZ3MsIHRvUmVxdWVzdCwgb3B0cywgYmVBZGFwdGVyKT0+e1xuICAgIGNvbnN0IGxheWVyID0gTGF5ZXIucHJvdmlkZShMYXllci5tZXJnZUFsbChQcmV0dHlMb2dnZXIubGF5ZXIoe1xuICAgICAgICBzaG93RmliZXJJZDogZmFsc2VcbiAgICB9KSwgd2l0aE1pbmltYWxMb2dMZXZlbCwgSHR0cENsaWVudC5sYXllciwgTGF5ZXIuc3VjY2VlZChIdHRwQ2xpZW50LkZldGNoLCBvcHRzLmNvbmZpZz8uZmV0Y2gpKSwgTGF5ZXIuc2V0Q29uZmlnUHJvdmlkZXIoY29uZmlnUHJvdmlkZXIob3B0cy5jb25maWcpKSk7XG4gICAgY29uc3QgbWFuYWdlZCA9IE1hbmFnZWRSdW50aW1lLm1ha2UobGF5ZXIpO1xuICAgIGNvbnN0IGhhbmRsZSA9IEVmZmVjdC5wcm9taXNlKCgpPT5tYW5hZ2VkLnJ1bnRpbWUoKS50aGVuKEh0dHBBcHAudG9XZWJIYW5kbGVyUnVudGltZSkpO1xuICAgIGNvbnN0IGFwcCA9ICguLi5hcmdzKT0+RWZmZWN0Lm1hcChFZmZlY3QucHJvbWlzZSgoKT0+bWFuYWdlZC5ydW5Qcm9taXNlKGNyZWF0ZVJlcXVlc3RIYW5kbGVyKG9wdHMsIGJlQWRhcHRlcikpKSwgRWZmZWN0LnByb3ZpZGVTZXJ2aWNlRWZmZWN0KE1pZGRsZXdhcmVBcmd1bWVudHMsIG1ha2VNaWRkbGV3YXJlQXJncyguLi5hcmdzKSkpO1xuICAgIHJldHVybiBhc3luYyAoLi4uYXJncyk9PmF3YWl0IGhhbmRsZS5waXBlKEVmZmVjdC5hcChhcHAoLi4uYXJncykpLCBFZmZlY3QuYXAodG9SZXF1ZXN0KC4uLmFyZ3MpKSwgRWZmZWN0LndpdGhMb2dTcGFuKFwicmVxdWVzdEhhbmRsZXJcIiksIG1hbmFnZWQucnVuUHJvbWlzZSk7XG59O1xuY29uc3QgY3JlYXRlUmVxdWVzdEhhbmRsZXIgPSAob3B0cywgYmVBZGFwdGVyKT0+RWZmZWN0LmdlbihmdW5jdGlvbiooKSB7XG4gICAgICAgIGNvbnN0IGlzRGV2ZWxvcG1lbnQgPSB5aWVsZCogSXNEZXZlbG9wbWVudDtcbiAgICAgICAgY29uc3Qgcm91dGVyQ29uZmlnID0geWllbGQqIGV4dHJhY3RSb3V0ZXJDb25maWcob3B0cy5yb3V0ZXIpO1xuICAgICAgICBjb25zdCBoYW5kbGVEYWVtb24gPSAoKCk9PntcbiAgICAgICAgICAgIGlmIChvcHRzLmNvbmZpZz8uaGFuZGxlRGFlbW9uUHJvbWlzZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBvcHRzLmNvbmZpZy5oYW5kbGVEYWVtb25Qcm9taXNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGlzRGV2ZWxvcG1lbnQgPyBcInZvaWRcIiA6IFwiYXdhaXRcIjtcbiAgICAgICAgfSkoKTtcbiAgICAgICAgaWYgKGlzRGV2ZWxvcG1lbnQgJiYgaGFuZGxlRGFlbW9uID09PSBcImF3YWl0XCIpIHtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCogbmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgIGNvZGU6IFwiSU5WQUxJRF9TRVJWRVJfQ09ORklHXCIsXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ2hhbmRsZURhZW1vblByb21pc2U6IFwiYXdhaXRcIiBpcyBmb3JiaWRkZW4gaW4gZGV2ZWxvcG1lbnQuJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgR0VUID0gRWZmZWN0LmdlbihmdW5jdGlvbiooKSB7XG4gICAgICAgICAgICByZXR1cm4geWllbGQqIEh0dHBTZXJ2ZXJSZXNwb25zZS5qc29uKHJvdXRlckNvbmZpZyk7XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBQT1NUID0gRWZmZWN0LmdlbihmdW5jdGlvbiooKSB7XG4gICAgICAgICAgICBjb25zdCB7IFwidXBsb2FkdGhpbmctaG9va1wiOiB1cGxvYWR0aGluZ0hvb2ssIFwieC11cGxvYWR0aGluZy1wYWNrYWdlXCI6IGZlUGFja2FnZSwgXCJ4LXVwbG9hZHRoaW5nLXZlcnNpb25cIjogY2xpZW50VmVyc2lvbiB9ID0geWllbGQqIEh0dHBTZXJ2ZXJSZXF1ZXN0LnNjaGVtYUhlYWRlcnMoUy5TdHJ1Y3Qoe1xuICAgICAgICAgICAgICAgIFwidXBsb2FkdGhpbmctaG9va1wiOiBVcGxvYWRUaGluZ0hvb2sucGlwZShTLm9wdGlvbmFsKSxcbiAgICAgICAgICAgICAgICBcIngtdXBsb2FkdGhpbmctcGFja2FnZVwiOiBTLlN0cmluZy5waXBlKFMub3B0aW9uYWxXaXRoKHtcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogKCk9PlwidW5rbm93blwiXG4gICAgICAgICAgICAgICAgfSkpLFxuICAgICAgICAgICAgICAgIFwieC11cGxvYWR0aGluZy12ZXJzaW9uXCI6IFMuU3RyaW5nLnBpcGUoUy5vcHRpb25hbFdpdGgoe1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiAoKT0+dmVyc2lvblxuICAgICAgICAgICAgICAgIH0pKVxuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgaWYgKGNsaWVudFZlcnNpb24gIT09IHZlcnNpb24pIHtcbiAgICAgICAgICAgICAgICBjb25zdCBtc2cgPSBgU2VydmVyIHZlcnNpb246ICR7dmVyc2lvbn0sIENsaWVudCB2ZXJzaW9uOiAke2NsaWVudFZlcnNpb259YDtcbiAgICAgICAgICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0Vycm9yKG1zZyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHlpZWxkKiBuZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICAgICAgICAgIGNvZGU6IFwiQkFEX1JFUVVFU1RcIixcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogXCJDbGllbnQgdmVyc2lvbiBtaXNtYXRjaFwiLFxuICAgICAgICAgICAgICAgICAgICBjYXVzZTogbXNnXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB7IHNsdWcsIGFjdGlvblR5cGUgfSA9IHlpZWxkKiBIdHRwUm91dGVyLnNjaGVtYVBhcmFtcyhTLlN0cnVjdCh7XG4gICAgICAgICAgICAgICAgYWN0aW9uVHlwZTogQWN0aW9uVHlwZS5waXBlKFMub3B0aW9uYWwpLFxuICAgICAgICAgICAgICAgIHNsdWc6IFMuU3RyaW5nXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICBjb25zdCB1cGxvYWRhYmxlID0gb3B0cy5yb3V0ZXJbc2x1Z107XG4gICAgICAgICAgICBpZiAoIXVwbG9hZGFibGUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBtc2cgPSBgTm8gZmlsZSByb3V0ZSBmb3VuZCBmb3Igc2x1ZyAke3NsdWd9YDtcbiAgICAgICAgICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0Vycm9yKG1zZyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHlpZWxkKiBuZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICAgICAgICAgIGNvZGU6IFwiTk9UX0ZPVU5EXCIsXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IG1zZ1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgeyBib2R5LCBmaWJlciB9ID0geWllbGQqIE1hdGNoLnZhbHVlKHtcbiAgICAgICAgICAgICAgICBhY3Rpb25UeXBlLFxuICAgICAgICAgICAgICAgIHVwbG9hZHRoaW5nSG9va1xuICAgICAgICAgICAgfSkucGlwZShNYXRjaC53aGVuKHtcbiAgICAgICAgICAgICAgICBhY3Rpb25UeXBlOiBcInVwbG9hZFwiLFxuICAgICAgICAgICAgICAgIHVwbG9hZHRoaW5nSG9vazogdW5kZWZpbmVkXG4gICAgICAgICAgICB9LCAoKT0+aGFuZGxlVXBsb2FkQWN0aW9uKHtcbiAgICAgICAgICAgICAgICAgICAgdXBsb2FkYWJsZSxcbiAgICAgICAgICAgICAgICAgICAgZmVQYWNrYWdlLFxuICAgICAgICAgICAgICAgICAgICBiZUFkYXB0ZXIsXG4gICAgICAgICAgICAgICAgICAgIHNsdWdcbiAgICAgICAgICAgICAgICB9KSksIE1hdGNoLndoZW4oe1xuICAgICAgICAgICAgICAgIGFjdGlvblR5cGU6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1cGxvYWR0aGluZ0hvb2s6IFwiY2FsbGJhY2tcIlxuICAgICAgICAgICAgfSwgKCk9PmhhbmRsZUNhbGxiYWNrUmVxdWVzdCh7XG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZGFibGUsXG4gICAgICAgICAgICAgICAgICAgIGZlUGFja2FnZSxcbiAgICAgICAgICAgICAgICAgICAgYmVBZGFwdGVyXG4gICAgICAgICAgICAgICAgfSkpLCBNYXRjaC53aGVuKHtcbiAgICAgICAgICAgICAgICBhY3Rpb25UeXBlOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdXBsb2FkdGhpbmdIb29rOiBcImVycm9yXCJcbiAgICAgICAgICAgIH0sICgpPT5oYW5kbGVFcnJvclJlcXVlc3Qoe1xuICAgICAgICAgICAgICAgICAgICB1cGxvYWRhYmxlXG4gICAgICAgICAgICAgICAgfSkpLCBNYXRjaC5vckVsc2UoKCk9PkVmZmVjdC5zdWNjZWVkKHtcbiAgICAgICAgICAgICAgICAgICAgYm9keTogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgZmliZXI6IG51bGxcbiAgICAgICAgICAgICAgICB9KSkpO1xuICAgICAgICAgICAgaWYgKGZpYmVyKSB7XG4gICAgICAgICAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhcIlJ1bm5pbmcgZmliZXIgYXMgZGFlbW9uXCIpLnBpcGUoRWZmZWN0LmFubm90YXRlTG9ncyhcImhhbmRsZURhZW1vblwiLCBoYW5kbGVEYWVtb24pKTtcbiAgICAgICAgICAgICAgICBpZiAoaGFuZGxlRGFlbW9uID09PSBcInZvaWRcIikgOyBlbHNlIGlmIChoYW5kbGVEYWVtb24gPT09IFwiYXdhaXRcIikge1xuICAgICAgICAgICAgICAgICAgICB5aWVsZCogZmliZXIuYXdhaXQ7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgaGFuZGxlRGFlbW9uID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlRGFlbW9uKEVmZmVjdC5ydW5Qcm9taXNlKGZpYmVyLmF3YWl0KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhcIlNlbmRpbmcgcmVzcG9uc2VcIikucGlwZShFZmZlY3QuYW5ub3RhdGVMb2dzKFwiYm9keVwiLCBib2R5KSk7XG4gICAgICAgICAgICByZXR1cm4geWllbGQqIEh0dHBTZXJ2ZXJSZXNwb25zZS5qc29uKGJvZHkpO1xuICAgICAgICB9KS5waXBlKEVmZmVjdC5jYXRjaFRhZ3Moe1xuICAgICAgICAgICAgUGFyc2VFcnJvcjogKGUpPT5IdHRwU2VydmVyUmVzcG9uc2UuanNvbihmb3JtYXRFcnJvcihuZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICAgICAgICAgIGNvZGU6IFwiQkFEX1JFUVVFU1RcIixcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogXCJJbnZhbGlkIGlucHV0XCIsXG4gICAgICAgICAgICAgICAgICAgIGNhdXNlOiBlLm1lc3NhZ2VcbiAgICAgICAgICAgICAgICB9KSwgb3B0cy5yb3V0ZXIpLCB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czogNDAwXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBVcGxvYWRUaGluZ0Vycm9yOiAoZSk9Pi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW5zYWZlLWFyZ3VtZW50XG4gICAgICAgICAgICAgICAgSHR0cFNlcnZlclJlc3BvbnNlLmpzb24oZm9ybWF0RXJyb3IoZSwgb3B0cy5yb3V0ZXIpLCB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czogZ2V0U3RhdHVzQ29kZUZyb21FcnJvcihlKVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgIH0pKTtcbiAgICAgICAgY29uc3QgYXBwZW5kUmVzcG9uc2VIZWFkZXJzID0gRWZmZWN0Lm1hcChIdHRwU2VydmVyUmVzcG9uc2Uuc2V0SGVhZGVyKFwieC11cGxvYWR0aGluZy12ZXJzaW9uXCIsIHZlcnNpb24pKTtcbiAgICAgICAgcmV0dXJuIEh0dHBSb3V0ZXIuZW1wdHkucGlwZShIdHRwUm91dGVyLmdldChcIipcIiwgR0VUKSwgSHR0cFJvdXRlci5wb3N0KFwiKlwiLCBQT1NUKSwgSHR0cFJvdXRlci51c2UoYXBwZW5kUmVzcG9uc2VIZWFkZXJzKSk7XG4gICAgfSkucGlwZShFZmZlY3Qud2l0aExvZ1NwYW4oXCJjcmVhdGVSZXF1ZXN0SGFuZGxlclwiKSk7XG5jb25zdCBoYW5kbGVFcnJvclJlcXVlc3QgPSAob3B0cyk9PkVmZmVjdC5nZW4oZnVuY3Rpb24qKCkge1xuICAgICAgICBjb25zdCB7IHVwbG9hZGFibGUgfSA9IG9wdHM7XG4gICAgICAgIGNvbnN0IHJlcXVlc3QgPSB5aWVsZCogSHR0cFNlcnZlclJlcXVlc3QuSHR0cFNlcnZlclJlcXVlc3Q7XG4gICAgICAgIGNvbnN0IHsgYXBpS2V5IH0gPSB5aWVsZCogVVRUb2tlbjtcbiAgICAgICAgY29uc3QgdmVyaWZpZWQgPSB5aWVsZCogdmVyaWZ5U2lnbmF0dXJlKCh5aWVsZCogcmVxdWVzdC50ZXh0KSwgcmVxdWVzdC5oZWFkZXJzW1wieC11cGxvYWR0aGluZy1zaWduYXR1cmVcIl0sIGFwaUtleSk7XG4gICAgICAgIHlpZWxkKiBFZmZlY3QubG9nRGVidWcoYFNpZ25hdHVyZSB2ZXJpZmllZDogJHt2ZXJpZmllZH1gKTtcbiAgICAgICAgaWYgKCF2ZXJpZmllZCkge1xuICAgICAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dFcnJvcihcIkludmFsaWQgc2lnbmF0dXJlXCIpO1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkKiBuZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICAgICAgY29kZTogXCJCQURfUkVRVUVTVFwiLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiSW52YWxpZCBzaWduYXR1cmVcIlxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVxdWVzdElucHV0ID0geWllbGQqIEh0dHBTZXJ2ZXJSZXF1ZXN0LnNjaGVtYUJvZHlKc29uKFMuU3RydWN0KHtcbiAgICAgICAgICAgIGZpbGVLZXk6IFMuU3RyaW5nLFxuICAgICAgICAgICAgZXJyb3I6IFMuU3RyaW5nXG4gICAgICAgIH0pKTtcbiAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhcIkhhbmRsaW5nIGVycm9yIGNhbGxiYWNrIHJlcXVlc3Qgd2l0aCBpbnB1dDpcIikucGlwZShFZmZlY3QuYW5ub3RhdGVMb2dzKFwianNvblwiLCByZXF1ZXN0SW5wdXQpKTtcbiAgICAgICAgY29uc3QgZmliZXIgPSB5aWVsZCogRWZmZWN0LnRyeVByb21pc2Uoe1xuICAgICAgICAgICAgdHJ5OiBhc3luYyAoKT0+dXBsb2FkYWJsZS5fZGVmLm9uVXBsb2FkRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICBlcnJvcjogbmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICAgICAgY29kZTogXCJVUExPQURfRkFJTEVEXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBgVXBsb2FkIGZhaWxlZCBmb3IgJHtyZXF1ZXN0SW5wdXQuZmlsZUtleX06ICR7cmVxdWVzdElucHV0LmVycm9yfWBcbiAgICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgICAgIGZpbGVLZXk6IHJlcXVlc3RJbnB1dC5maWxlS2V5XG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBjYXRjaDogKGVycm9yKT0+bmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICBjb2RlOiBcIklOVEVSTkFMX1NFUlZFUl9FUlJPUlwiLFxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBcIkZhaWxlZCB0byBydW4gb25VcGxvYWRFcnJvclwiLFxuICAgICAgICAgICAgICAgICAgICBjYXVzZTogZXJyb3JcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICB9KS5waXBlKEVmZmVjdC50YXBFcnJvcigoZXJyb3IpPT5FZmZlY3QubG9nRXJyb3IoXCJGYWlsZWQgdG8gcnVuIG9uVXBsb2FkRXJyb3IuIFlvdSBwcm9iYWJseSBzaG91bGRuJ3QgYmUgdGhyb3dpbmcgZXJyb3JzIGhlcmUuXCIpLnBpcGUoRWZmZWN0LmFubm90YXRlTG9ncyhcImVycm9yXCIsIGVycm9yKSkpKS5waXBlKEVmZmVjdC5pZ25vcmVMb2dnZWQsIEVmZmVjdC5mb3JrRGFlbW9uKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGJvZHk6IG51bGwsXG4gICAgICAgICAgICBmaWJlclxuICAgICAgICB9O1xuICAgIH0pLnBpcGUoRWZmZWN0LndpdGhMb2dTcGFuKFwiaGFuZGxlRXJyb3JSZXF1ZXN0XCIpKTtcbmNvbnN0IGhhbmRsZUNhbGxiYWNrUmVxdWVzdCA9IChvcHRzKT0+RWZmZWN0LmdlbihmdW5jdGlvbiooKSB7XG4gICAgICAgIGNvbnN0IHsgdXBsb2FkYWJsZSwgZmVQYWNrYWdlLCBiZUFkYXB0ZXIgfSA9IG9wdHM7XG4gICAgICAgIGNvbnN0IHJlcXVlc3QgPSB5aWVsZCogSHR0cFNlcnZlclJlcXVlc3QuSHR0cFNlcnZlclJlcXVlc3Q7XG4gICAgICAgIGNvbnN0IHsgYXBpS2V5IH0gPSB5aWVsZCogVVRUb2tlbjtcbiAgICAgICAgY29uc3QgdmVyaWZpZWQgPSB5aWVsZCogdmVyaWZ5U2lnbmF0dXJlKCh5aWVsZCogcmVxdWVzdC50ZXh0KSwgcmVxdWVzdC5oZWFkZXJzW1wieC11cGxvYWR0aGluZy1zaWduYXR1cmVcIl0sIGFwaUtleSk7XG4gICAgICAgIHlpZWxkKiBFZmZlY3QubG9nRGVidWcoYFNpZ25hdHVyZSB2ZXJpZmllZDogJHt2ZXJpZmllZH1gKTtcbiAgICAgICAgaWYgKCF2ZXJpZmllZCkge1xuICAgICAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dFcnJvcihcIkludmFsaWQgc2lnbmF0dXJlXCIpO1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkKiBuZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICAgICAgY29kZTogXCJCQURfUkVRVUVTVFwiLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiSW52YWxpZCBzaWduYXR1cmVcIlxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVxdWVzdElucHV0ID0geWllbGQqIEh0dHBTZXJ2ZXJSZXF1ZXN0LnNjaGVtYUJvZHlKc29uKFMuU3RydWN0KHtcbiAgICAgICAgICAgIHN0YXR1czogUy5TdHJpbmcsXG4gICAgICAgICAgICBmaWxlOiBVcGxvYWRlZEZpbGVEYXRhLFxuICAgICAgICAgICAgbWV0YWRhdGE6IFMuUmVjb3JkKHtcbiAgICAgICAgICAgICAgICBrZXk6IFMuU3RyaW5nLFxuICAgICAgICAgICAgICAgIHZhbHVlOiBTLlVua25vd25cbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pKTtcbiAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhcIkhhbmRsaW5nIGNhbGxiYWNrIHJlcXVlc3Qgd2l0aCBpbnB1dDpcIikucGlwZShFZmZlY3QuYW5ub3RhdGVMb2dzKFwianNvblwiLCByZXF1ZXN0SW5wdXQpKTtcbiAgICAgICAgLyoqXG4gICAgICogUnVuIGAub25VcGxvYWRDb21wbGV0ZWAgYXMgYSBkYWVtb24gdG8gcHJldmVudCB0aGVcbiAgICAgKiByZXF1ZXN0IGZyb20gVVQgdG8gcG90ZW50aWFsbHkgdGltZW91dC5cbiAgICAgKi8gY29uc3QgZmliZXIgPSB5aWVsZCogRWZmZWN0LmdlbihmdW5jdGlvbiooKSB7XG4gICAgICAgICAgICBjb25zdCBzZXJ2ZXJEYXRhID0geWllbGQqIEVmZmVjdC50cnlQcm9taXNlKHtcbiAgICAgICAgICAgICAgICB0cnk6IGFzeW5jICgpPT51cGxvYWRhYmxlLnJlc29sdmVyKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGU6IHJlcXVlc3RJbnB1dC5maWxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGE6IHJlcXVlc3RJbnB1dC5tZXRhZGF0YVxuICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBjYXRjaDogKGVycm9yKT0+bmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICAgICAgY29kZTogXCJJTlRFUk5BTF9TRVJWRVJfRVJST1JcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIHJ1biBvblVwbG9hZENvbXBsZXRlLiBZb3UgcHJvYmFibHkgc2hvdWxkbid0IGJlIHRocm93aW5nIGVycm9ycyBoZXJlLlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2F1c2U6IGVycm9yXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICAgICAgICAgICAgZmlsZUtleTogcmVxdWVzdElucHV0LmZpbGUua2V5LFxuICAgICAgICAgICAgICAgIGNhbGxiYWNrRGF0YTogc2VydmVyRGF0YSA/PyBudWxsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhcIidvblVwbG9hZENvbXBsZXRlJyBjYWxsYmFjayBmaW5pc2hlZC4gU2VuZGluZyByZXNwb25zZSB0byBVcGxvYWRUaGluZzpcIikucGlwZShFZmZlY3QuYW5ub3RhdGVMb2dzKFwiY2FsbGJhY2tEYXRhXCIsIHBheWxvYWQpKTtcbiAgICAgICAgICAgIGNvbnN0IGJhc2VVcmwgPSB5aWVsZCogSW5nZXN0VXJsO1xuICAgICAgICAgICAgY29uc3QgaHR0cENsaWVudCA9IHlpZWxkKiBIdHRwQ2xpZW50Lkh0dHBDbGllbnQ7XG4gICAgICAgICAgICB5aWVsZCogSHR0cENsaWVudFJlcXVlc3QucG9zdChgL2NhbGxiYWNrLXJlc3VsdGApLnBpcGUoSHR0cENsaWVudFJlcXVlc3QucHJlcGVuZFVybChiYXNlVXJsKSwgSHR0cENsaWVudFJlcXVlc3Quc2V0SGVhZGVycyh7XG4gICAgICAgICAgICAgICAgXCJ4LXVwbG9hZHRoaW5nLWFwaS1rZXlcIjogYXBpS2V5LFxuICAgICAgICAgICAgICAgIFwieC11cGxvYWR0aGluZy12ZXJzaW9uXCI6IHZlcnNpb24sXG4gICAgICAgICAgICAgICAgXCJ4LXVwbG9hZHRoaW5nLWJlLWFkYXB0ZXJcIjogYmVBZGFwdGVyLFxuICAgICAgICAgICAgICAgIFwieC11cGxvYWR0aGluZy1mZS1wYWNrYWdlXCI6IGZlUGFja2FnZVxuICAgICAgICAgICAgfSksIEh0dHBDbGllbnRSZXF1ZXN0Lmpzb25Cb2R5KHBheWxvYWQpLCBFZmZlY3QuZmxhdE1hcChIdHRwQ2xpZW50LmZpbHRlclN0YXR1c09rKGh0dHBDbGllbnQpKSwgRWZmZWN0LnRhcEVycm9yVGFnKFwiUmVzcG9uc2VFcnJvclwiLCAoeyByZXNwb25zZTogcmVzIH0pPT5FZmZlY3QuZmxhdE1hcChyZXMuanNvbiwgKGpzb24pPT5FZmZlY3QubG9nRXJyb3IoYEZhaWxlZCB0byByZWdpc3RlciBjYWxsYmFjayByZXN1bHQgKCR7cmVzLnN0YXR1c30pYCkucGlwZShFZmZlY3QuYW5ub3RhdGVMb2dzKFwiZXJyb3JcIiwganNvbikpKSksIEh0dHBDbGllbnRSZXNwb25zZS5zY2hlbWFCb2R5SnNvblNjb3BlZChDYWxsYmFja1Jlc3VsdFJlc3BvbnNlKSwgRWZmZWN0LnRhcChFZmZlY3QubG9nKFwiU2VudCBjYWxsYmFjayByZXN1bHQgdG8gVXBsb2FkVGhpbmdcIikpKTtcbiAgICAgICAgfSkucGlwZShFZmZlY3QuaWdub3JlTG9nZ2VkLCBFZmZlY3QuZm9ya0RhZW1vbik7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBib2R5OiBudWxsLFxuICAgICAgICAgICAgZmliZXJcbiAgICAgICAgfTtcbiAgICB9KS5waXBlKEVmZmVjdC53aXRoTG9nU3BhbihcImhhbmRsZUNhbGxiYWNrUmVxdWVzdFwiKSk7XG5jb25zdCBydW5Sb3V0ZU1pZGRsZXdhcmUgPSAob3B0cyk9PkVmZmVjdC5nZW4oZnVuY3Rpb24qKCkge1xuICAgICAgICBjb25zdCBtaWRkbGV3YXJlQXJncyA9IHlpZWxkKiBNaWRkbGV3YXJlQXJndW1lbnRzO1xuICAgICAgICBjb25zdCB7IGpzb246IHsgZmlsZXMsIGlucHV0IH0sIHVwbG9hZGFibGUgfSA9IG9wdHM7XG4gICAgICAgIHlpZWxkKiBFZmZlY3QubG9nRGVidWcoXCJSdW5uaW5nIG1pZGRsZXdhcmVcIik7XG4gICAgICAgIGNvbnN0IG1ldGFkYXRhID0geWllbGQqIEVmZmVjdC50cnlQcm9taXNlKHtcbiAgICAgICAgICAgIHRyeTogYXN5bmMgKCk9PnVwbG9hZGFibGUuX2RlZi5taWRkbGV3YXJlKHtcbiAgICAgICAgICAgICAgICAgICAgLi4ubWlkZGxld2FyZUFyZ3MsXG4gICAgICAgICAgICAgICAgICAgIGlucHV0LFxuICAgICAgICAgICAgICAgICAgICBmaWxlc1xuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgY2F0Y2g6IChlcnJvcik9PmVycm9yIGluc3RhbmNlb2YgVXBsb2FkVGhpbmdFcnJvciA/IGVycm9yIDogbmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICBjb2RlOiBcIklOVEVSTkFMX1NFUlZFUl9FUlJPUlwiLFxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBcIkZhaWxlZCB0byBydW4gbWlkZGxld2FyZVwiLFxuICAgICAgICAgICAgICAgICAgICBjYXVzZTogZXJyb3JcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKG1ldGFkYXRhW1VURmlsZXNdICYmIG1ldGFkYXRhW1VURmlsZXNdLmxlbmd0aCAhPT0gZmlsZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICBjb25zdCBtc2cgPSBgRXhwZWN0ZWQgZmlsZXMgb3ZlcnJpZGUgdG8gaGF2ZSB0aGUgc2FtZSBsZW5ndGggYXMgb3JpZ2luYWwgZmlsZXMsIGdvdCAke21ldGFkYXRhW1VURmlsZXNdLmxlbmd0aH0gYnV0IGV4cGVjdGVkICR7ZmlsZXMubGVuZ3RofWA7XG4gICAgICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0Vycm9yKG1zZyk7XG4gICAgICAgICAgICByZXR1cm4geWllbGQqIG5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICBjb2RlOiBcIkJBRF9SRVFVRVNUXCIsXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogXCJGaWxlcyBvdmVycmlkZSBtdXN0IGhhdmUgdGhlIHNhbWUgbGVuZ3RoIGFzIGZpbGVzXCIsXG4gICAgICAgICAgICAgICAgY2F1c2U6IG1zZ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQXR0YWNoIGN1c3RvbUlkcyBmcm9tIG1pZGRsZXdhcmUgdG8gdGhlIGZpbGVzXG4gICAgICAgIGNvbnN0IGZpbGVzV2l0aEN1c3RvbUlkcyA9IHlpZWxkKiBFZmZlY3QuZm9yRWFjaChmaWxlcywgKGZpbGUsIGlkeCk9PkVmZmVjdC5nZW4oZnVuY3Rpb24qKCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRoZWlycyA9IG1ldGFkYXRhW1VURmlsZXNdPy5baWR4XTtcbiAgICAgICAgICAgICAgICBpZiAodGhlaXJzICYmIHRoZWlycy5zaXplICE9PSBmaWxlLnNpemUpIHtcbiAgICAgICAgICAgICAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dXYXJuaW5nKFwiRmlsZSBzaXplIG1pc21hdGNoLiBSZXZlcnRpbmcgdG8gb3JpZ2luYWwgc2l6ZVwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogdGhlaXJzPy5uYW1lID8/IGZpbGUubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgc2l6ZTogZmlsZS5zaXplLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBmaWxlLnR5cGUsXG4gICAgICAgICAgICAgICAgICAgIGN1c3RvbUlkOiB0aGVpcnM/LmN1c3RvbUlkLFxuICAgICAgICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IHRoZWlycz8ubGFzdE1vZGlmaWVkID8/IERhdGUubm93KClcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbWV0YWRhdGEsXG4gICAgICAgICAgICBmaWxlc1dpdGhDdXN0b21JZHNcbiAgICAgICAgfTtcbiAgICB9KS5waXBlKEVmZmVjdC53aXRoTG9nU3BhbihcInJ1blJvdXRlTWlkZGxld2FyZVwiKSk7XG5jb25zdCBoYW5kbGVVcGxvYWRBY3Rpb24gPSAob3B0cyk9PkVmZmVjdC5nZW4oZnVuY3Rpb24qKCkge1xuICAgICAgICBjb25zdCBodHRwQ2xpZW50ID0geWllbGQqIEh0dHBDbGllbnQuSHR0cENsaWVudDtcbiAgICAgICAgY29uc3QgeyB1cGxvYWRhYmxlLCBmZVBhY2thZ2UsIGJlQWRhcHRlciwgc2x1ZyB9ID0gb3B0cztcbiAgICAgICAgY29uc3QganNvbiA9IHlpZWxkKiBIdHRwU2VydmVyUmVxdWVzdC5zY2hlbWFCb2R5SnNvbihVcGxvYWRBY3Rpb25QYXlsb2FkKTtcbiAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhcIkhhbmRsaW5nIHVwbG9hZCByZXF1ZXN0XCIpLnBpcGUoRWZmZWN0LmFubm90YXRlTG9ncyhcImpzb25cIiwganNvbikpO1xuICAgICAgICAvLyB2YWxpZGF0ZSB0aGUgaW5wdXRcbiAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhcIlBhcnNpbmcgdXNlciBpbnB1dFwiKTtcbiAgICAgICAgY29uc3QgaW5wdXRQYXJzZXIgPSB1cGxvYWRhYmxlLl9kZWYuaW5wdXRQYXJzZXI7XG4gICAgICAgIGNvbnN0IHBhcnNlZElucHV0ID0geWllbGQqIEVmZmVjdC50cnlQcm9taXNlKHtcbiAgICAgICAgICAgIHRyeTogYXN5bmMgKCk9PmdldFBhcnNlRm4oaW5wdXRQYXJzZXIpKGpzb24uaW5wdXQpLFxuICAgICAgICAgICAgY2F0Y2g6IChlcnJvcik9Pm5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgY29kZTogXCJCQURfUkVRVUVTVFwiLFxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBcIkludmFsaWQgaW5wdXRcIixcbiAgICAgICAgICAgICAgICAgICAgY2F1c2U6IGVycm9yXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgfSk7XG4gICAgICAgIHlpZWxkKiBFZmZlY3QubG9nRGVidWcoXCJJbnB1dCBwYXJzZWQgc3VjY2Vzc2Z1bGx5XCIpLnBpcGUoRWZmZWN0LmFubm90YXRlTG9ncyhcImlucHV0XCIsIHBhcnNlZElucHV0KSk7XG4gICAgICAgIGNvbnN0IHsgbWV0YWRhdGEsIGZpbGVzV2l0aEN1c3RvbUlkcyB9ID0geWllbGQqIHJ1blJvdXRlTWlkZGxld2FyZSh7XG4gICAgICAgICAgICBqc29uOiB7XG4gICAgICAgICAgICAgICAgaW5wdXQ6IHBhcnNlZElucHV0LFxuICAgICAgICAgICAgICAgIGZpbGVzOiBqc29uLmZpbGVzXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdXBsb2FkYWJsZVxuICAgICAgICB9KTtcbiAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhcIlBhcnNpbmcgcm91dGUgY29uZmlnXCIpLnBpcGUoRWZmZWN0LmFubm90YXRlTG9ncyhcInJvdXRlckNvbmZpZ1wiLCB1cGxvYWRhYmxlLl9kZWYucm91dGVyQ29uZmlnKSk7XG4gICAgICAgIGNvbnN0IHBhcnNlZENvbmZpZyA9IHlpZWxkKiBmaWxsSW5wdXRSb3V0ZUNvbmZpZyh1cGxvYWRhYmxlLl9kZWYucm91dGVyQ29uZmlnKS5waXBlKEVmZmVjdC5jYXRjaFRhZyhcIkludmFsaWRSb3V0ZUNvbmZpZ1wiLCAoZXJyKT0+bmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgIGNvZGU6IFwiQkFEX1JFUVVFU1RcIixcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBcIkludmFsaWQgcm91dGUgY29uZmlnXCIsXG4gICAgICAgICAgICAgICAgY2F1c2U6IGVyclxuICAgICAgICAgICAgfSkpKTtcbiAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhcIlJvdXRlIGNvbmZpZyBwYXJzZWQgc3VjY2Vzc2Z1bGx5XCIpLnBpcGUoRWZmZWN0LmFubm90YXRlTG9ncyhcInJvdXRlQ29uZmlnXCIsIHBhcnNlZENvbmZpZykpO1xuICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0RlYnVnKFwiVmFsaWRhdGluZyBmaWxlcyBtZWV0IHRoZSBjb25maWcgcmVxdWlyZW1lbnRzXCIpLnBpcGUoRWZmZWN0LmFubm90YXRlTG9ncyhcImZpbGVzXCIsIGpzb24uZmlsZXMpKTtcbiAgICAgICAgeWllbGQqIGFzc2VydEZpbGVzTWVldENvbmZpZyhqc29uLmZpbGVzLCBwYXJzZWRDb25maWcpLnBpcGUoRWZmZWN0Lm1hcEVycm9yKChlKT0+bmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgIGNvZGU6IFwiQkFEX1JFUVVFU1RcIixcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBgSW52YWxpZCBjb25maWc6ICR7ZS5fdGFnfWAsXG4gICAgICAgICAgICAgICAgY2F1c2U6IFwicmVhc29uXCIgaW4gZSA/IGUucmVhc29uIDogZS5tZXNzYWdlXG4gICAgICAgICAgICB9KSkpO1xuICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0RlYnVnKFwiRmlsZXMgdmFsaWRhdGVkLlwiKTtcbiAgICAgICAgY29uc3QgZmlsZVVwbG9hZFJlcXVlc3RzID0geWllbGQqIEVmZmVjdC5mb3JFYWNoKGZpbGVzV2l0aEN1c3RvbUlkcywgKGZpbGUpPT5FZmZlY3QubWFwKGdldFR5cGVGcm9tRmlsZU5hbWUoZmlsZS5uYW1lLCBvYmplY3RLZXlzKHBhcnNlZENvbmZpZykpLCAodHlwZSk9Pih7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IGZpbGUubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgc2l6ZTogZmlsZS5zaXplLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBmaWxlLnR5cGUsXG4gICAgICAgICAgICAgICAgICAgIGxhc3RNb2RpZmllZDogZmlsZS5sYXN0TW9kaWZpZWQsXG4gICAgICAgICAgICAgICAgICAgIGN1c3RvbUlkOiBmaWxlLmN1c3RvbUlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZW50RGlzcG9zaXRpb246IHBhcnNlZENvbmZpZ1t0eXBlXT8uY29udGVudERpc3Bvc2l0aW9uID8/IFwiaW5saW5lXCIsXG4gICAgICAgICAgICAgICAgICAgIGFjbDogcGFyc2VkQ29uZmlnW3R5cGVdPy5hY2xcbiAgICAgICAgICAgICAgICB9KSkpLnBpcGUoRWZmZWN0LmNhdGNoVGFncyh7XG4gICAgICAgICAgICAvKiogU2hvdWxkbid0IGhhcHBlbiBzaW5jZSBjb25maWcgaXMgdmFsaWRhdGVkIGFib3ZlIHNvIGp1c3QgZHlpbmcgaXMgZmluZSBJIHRoaW5rICovIEludmFsaWRGaWxlVHlwZTogKGUpPT5FZmZlY3QuZGllKGUpLFxuICAgICAgICAgICAgVW5rbm93bkZpbGVUeXBlOiAoZSk9PkVmZmVjdC5kaWUoZSlcbiAgICAgICAgfSkpO1xuICAgICAgICBjb25zdCByb3V0ZU9wdGlvbnMgPSB1cGxvYWRhYmxlLl9kZWYucm91dGVPcHRpb25zO1xuICAgICAgICBjb25zdCB7IGFwaUtleSwgYXBwSWQgfSA9IHlpZWxkKiBVVFRva2VuO1xuICAgICAgICBjb25zdCBpbmdlc3RVcmwgPSB5aWVsZCogSW5nZXN0VXJsO1xuICAgICAgICBjb25zdCBpc0RldiA9IHlpZWxkKiBJc0RldmVsb3BtZW50O1xuICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0RlYnVnKFwiR2VuZXJhdGluZyBwcmVzaWduZWQgVVJMc1wiKS5waXBlKEVmZmVjdC5hbm5vdGF0ZUxvZ3MoXCJmaWxlVXBsb2FkUmVxdWVzdHNcIiwgZmlsZVVwbG9hZFJlcXVlc3RzKSwgRWZmZWN0LmFubm90YXRlTG9ncyhcImluZ2VzdFVybFwiLCBpbmdlc3RVcmwpKTtcbiAgICAgICAgY29uc3QgcHJlc2lnbmVkVXJscyA9IHlpZWxkKiBFZmZlY3QuZm9yRWFjaChmaWxlVXBsb2FkUmVxdWVzdHMsIChmaWxlKT0+RWZmZWN0LmdlbihmdW5jdGlvbiooKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qga2V5ID0geWllbGQqIGdlbmVyYXRlS2V5KGZpbGUsIGFwcElkLCByb3V0ZU9wdGlvbnMuZ2V0RmlsZUhhc2hQYXJ0cyk7XG4gICAgICAgICAgICAgICAgY29uc3QgdXJsID0geWllbGQqIGdlbmVyYXRlU2lnbmVkVVJMKGAke2luZ2VzdFVybH0vJHtrZXl9YCwgYXBpS2V5LCB7XG4gICAgICAgICAgICAgICAgICAgIHR0bEluU2Vjb25kczogcm91dGVPcHRpb25zLnByZXNpZ25lZFVSTFRUTCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJ4LXV0LWlkZW50aWZpZXJcIjogYXBwSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBcIngtdXQtZmlsZS1uYW1lXCI6IGZpbGUubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwieC11dC1maWxlLXNpemVcIjogZmlsZS5zaXplLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ4LXV0LWZpbGUtdHlwZVwiOiBmaWxlLnR5cGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBcIngtdXQtc2x1Z1wiOiBzbHVnLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ4LXV0LWN1c3RvbS1pZFwiOiBmaWxlLmN1c3RvbUlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ4LXV0LWNvbnRlbnQtZGlzcG9zaXRpb25cIjogZmlsZS5jb250ZW50RGlzcG9zaXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBcIngtdXQtYWNsXCI6IGZpbGUuYWNsXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICB1cmwsXG4gICAgICAgICAgICAgICAgICAgIGtleVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9KSwge1xuICAgICAgICAgICAgY29uY3VycmVuY3k6IFwidW5ib3VuZGVkXCJcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHNlcnZlclJlcSA9IHlpZWxkKiBIdHRwU2VydmVyUmVxdWVzdC5IdHRwU2VydmVyUmVxdWVzdDtcbiAgICAgICAgY29uc3QgcmVxdWVzdFVybCA9IHlpZWxkKiBIdHRwU2VydmVyUmVxdWVzdC50b1VSTChzZXJ2ZXJSZXEpO1xuICAgICAgICBjb25zdCBkZXZIb29rUmVxdWVzdCA9IHlpZWxkKiBDb25maWcuc3RyaW5nKFwiY2FsbGJhY2tVcmxcIikucGlwZShDb25maWcud2l0aERlZmF1bHQocmVxdWVzdFVybC5vcmlnaW4gKyByZXF1ZXN0VXJsLnBhdGhuYW1lKSwgRWZmZWN0Lm1hcCgodXJsKT0+SHR0cENsaWVudFJlcXVlc3QucG9zdCh1cmwpLnBpcGUoSHR0cENsaWVudFJlcXVlc3QuYXBwZW5kVXJsUGFyYW0oXCJzbHVnXCIsIHNsdWcpKSkpO1xuICAgICAgICBjb25zdCBtZXRhZGF0YVJlcXVlc3QgPSBIdHRwQ2xpZW50UmVxdWVzdC5wb3N0KFwiL3JvdXRlLW1ldGFkYXRhXCIpLnBpcGUoSHR0cENsaWVudFJlcXVlc3QucHJlcGVuZFVybChpbmdlc3RVcmwpLCBIdHRwQ2xpZW50UmVxdWVzdC5zZXRIZWFkZXJzKHtcbiAgICAgICAgICAgIFwieC11cGxvYWR0aGluZy1hcGkta2V5XCI6IGFwaUtleSxcbiAgICAgICAgICAgIFwieC11cGxvYWR0aGluZy12ZXJzaW9uXCI6IHZlcnNpb24sXG4gICAgICAgICAgICBcIngtdXBsb2FkdGhpbmctYmUtYWRhcHRlclwiOiBiZUFkYXB0ZXIsXG4gICAgICAgICAgICBcIngtdXBsb2FkdGhpbmctZmUtcGFja2FnZVwiOiBmZVBhY2thZ2VcbiAgICAgICAgfSksIEh0dHBDbGllbnRSZXF1ZXN0Lmpzb25Cb2R5KHtcbiAgICAgICAgICAgIGZpbGVLZXlzOiBwcmVzaWduZWRVcmxzLm1hcCgoeyBrZXkgfSk9PmtleSksXG4gICAgICAgICAgICBtZXRhZGF0YTogbWV0YWRhdGEsXG4gICAgICAgICAgICBpc0RldixcbiAgICAgICAgICAgIGNhbGxiYWNrVXJsOiBkZXZIb29rUmVxdWVzdC51cmwsXG4gICAgICAgICAgICBjYWxsYmFja1NsdWc6IHNsdWcsXG4gICAgICAgICAgICBhd2FpdFNlcnZlckRhdGE6IHJvdXRlT3B0aW9ucy5hd2FpdFNlcnZlckRhdGEgPz8gdHJ1ZVxuICAgICAgICB9KSwgRWZmZWN0LmZsYXRNYXAoSHR0cENsaWVudC5maWx0ZXJTdGF0dXNPayhodHRwQ2xpZW50KSksIEVmZmVjdC50YXBCb3RoKHtcbiAgICAgICAgICAgIG9uU3VjY2VzczogKHJlcyk9PkVmZmVjdC5sb2dEZWJ1ZyhcIlJlZ2lzdGVycmVkIG1ldGFkYXRhXCIpLnBpcGUoRWZmZWN0LmFubm90YXRlTG9ncyhcInJlc3BvbnNlXCIsIHJlcykpLFxuICAgICAgICAgICAgb25GYWlsdXJlOiAoZXJyKT0+ZXJyLl90YWcgPT09IFwiUmVzcG9uc2VFcnJvclwiID8gRWZmZWN0LmZsYXRNYXAoZXJyLnJlc3BvbnNlLmpzb24sIChqc29uKT0+RWZmZWN0LmxvZ0Vycm9yKGBGYWlsZWQgdG8gcmVnaXN0ZXIgbWV0YWRhdGEgKCR7ZXJyLnJlc3BvbnNlLnN0YXR1c30pYCkucGlwZShFZmZlY3QuYW5ub3RhdGVMb2dzKFwicmVzcG9uc2VcIiwgZXJyLnJlc3BvbnNlKSwgRWZmZWN0LmFubm90YXRlTG9ncyhcImpzb25cIiwganNvbikpKSA6IEVmZmVjdC5sb2dFcnJvcihcIkZhaWxlZCB0byByZWdpc3RlciBtZXRhZGF0YVwiKS5waXBlKEVmZmVjdC5hbm5vdGF0ZUxvZ3MoXCJlcnJvclwiLCBlcnIpKVxuICAgICAgICB9KSk7XG4gICAgICAgIC8vIFNlbmQgbWV0YWRhdGEgdG8gVVQgc2VydmVyIChub24gYmxvY2tpbmcgYXMgYSBkYWVtb24pXG4gICAgICAgIC8vIEluIGRldiwga2VlcCB0aGUgc3RyZWFtIG9wZW4gYW5kIHNpbXVsYXRlIHRoZSBjYWxsYmFjayByZXF1ZXN0cyBhc1xuICAgICAgICAvLyBmaWxlcyBjb21wbGV0ZSB1cGxvYWRpbmdcbiAgICAgICAgY29uc3QgZmliZXIgPSB5aWVsZCogRWZmZWN0LmlmKGlzRGV2LCB7XG4gICAgICAgICAgICBvblRydWU6ICgpPT5tZXRhZGF0YVJlcXVlc3QucGlwZShIdHRwQ2xpZW50UmVzcG9uc2Uuc3RyZWFtLCBoYW5kbGVKc29uTGluZVN0cmVhbShNZXRhZGF0YUZldGNoU3RyZWFtUGFydCwgKHsgcGF5bG9hZCwgc2lnbmF0dXJlLCBob29rIH0pPT5kZXZIb29rUmVxdWVzdC5waXBlKEh0dHBDbGllbnRSZXF1ZXN0LnNldEhlYWRlcnMoe1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJ1cGxvYWR0aGluZy1ob29rXCI6IGhvb2ssXG4gICAgICAgICAgICAgICAgICAgICAgICBcIngtdXBsb2FkdGhpbmctc2lnbmF0dXJlXCI6IHNpZ25hdHVyZVxuICAgICAgICAgICAgICAgICAgICB9KSwgSHR0cENsaWVudFJlcXVlc3Quc2V0Qm9keShIdHRwQm9keS50ZXh0KHBheWxvYWQsIFwiYXBwbGljYXRpb24vanNvblwiKSksIGh0dHBDbGllbnQsIEh0dHBDbGllbnRSZXNwb25zZS5hcnJheUJ1ZmZlciwgRWZmZWN0LmFzVm9pZCwgRWZmZWN0LnRhcChFZmZlY3QubG9nKGBTdWNjZXNzZnVsbHkgc2ltdWxhdGVkICcke2hvb2t9JyBldmVudGApKSwgRWZmZWN0Lmlnbm9yZUxvZ2dlZCkpKSxcbiAgICAgICAgICAgIG9uRmFsc2U6ICgpPT5tZXRhZGF0YVJlcXVlc3QucGlwZShIdHRwQ2xpZW50UmVzcG9uc2Uuc2NoZW1hQm9keUpzb25TY29wZWQoTWV0YWRhdGFGZXRjaFJlc3BvbnNlKSlcbiAgICAgICAgfSkucGlwZShFZmZlY3QuZm9ya0RhZW1vbik7XG4gICAgICAgIGNvbnN0IHByZXNpZ25lZHMgPSBwcmVzaWduZWRVcmxzLm1hcCgocCwgaSk9Pih7XG4gICAgICAgICAgICAgICAgdXJsOiBwLnVybCxcbiAgICAgICAgICAgICAgICBrZXk6IHAua2V5LFxuICAgICAgICAgICAgICAgIG5hbWU6IGZpbGVVcGxvYWRSZXF1ZXN0c1tpXS5uYW1lLFxuICAgICAgICAgICAgICAgIGN1c3RvbUlkOiBmaWxlVXBsb2FkUmVxdWVzdHNbaV0uY3VzdG9tSWQgPz8gbnVsbFxuICAgICAgICAgICAgfSkpO1xuICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0luZm8oXCJTZW5kaW5nIHByZXNpZ25lZCBVUkxzIHRvIGNsaWVudFwiKS5waXBlKEVmZmVjdC5hbm5vdGF0ZUxvZ3MoXCJwcmVzaWduZWRVcmxzXCIsIHByZXNpZ25lZHMpKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGJvZHk6IHByZXNpZ25lZHMsXG4gICAgICAgICAgICBmaWJlclxuICAgICAgICB9O1xuICAgIH0pLnBpcGUoRWZmZWN0LndpdGhMb2dTcGFuKFwiaGFuZGxlVXBsb2FkQWN0aW9uXCIpKTtcblxuZnVuY3Rpb24gaW50ZXJuYWxDcmVhdGVCdWlsZGVyKGluaXREZWYgPSB7fSkge1xuICAgIGNvbnN0IF9kZWYgPSB7XG4gICAgICAgIC8vIERlZmF1bHQgcm91dGVyIGNvbmZpZ1xuICAgICAgICByb3V0ZXJDb25maWc6IHtcbiAgICAgICAgICAgIGltYWdlOiB7XG4gICAgICAgICAgICAgICAgbWF4RmlsZVNpemU6IFwiNE1CXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgcm91dGVPcHRpb25zOiB7XG4gICAgICAgICAgICBhd2FpdFNlcnZlckRhdGE6IHRydWVcbiAgICAgICAgfSxcbiAgICAgICAgaW5wdXRQYXJzZXI6IHtcbiAgICAgICAgICAgIHBhcnNlOiAoKT0+dW5kZWZpbmVkLFxuICAgICAgICAgICAgX2lucHV0OiB1bmRlZmluZWQsXG4gICAgICAgICAgICBfb3V0cHV0OiB1bmRlZmluZWRcbiAgICAgICAgfSxcbiAgICAgICAgbWlkZGxld2FyZTogKCk9Pih7fSksXG4gICAgICAgIG9uVXBsb2FkRXJyb3I6ICgpPT57XG4gICAgICAgIC8vIG5vb3BcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3JGb3JtYXR0ZXI6IGluaXREZWYuZXJyb3JGb3JtYXR0ZXIgPz8gZGVmYXVsdEVycm9yRm9ybWF0dGVyLFxuICAgICAgICAvLyBPdmVybG9hZCB3aXRoIHByb3BlcnRpZXMgcGFzc2VkIGluXG4gICAgICAgIC4uLmluaXREZWZcbiAgICB9O1xuICAgIHJldHVybiB7XG4gICAgICAgIGlucHV0ICh1c2VyUGFyc2VyKSB7XG4gICAgICAgICAgICByZXR1cm4gaW50ZXJuYWxDcmVhdGVCdWlsZGVyKHtcbiAgICAgICAgICAgICAgICAuLi5fZGVmLFxuICAgICAgICAgICAgICAgIGlucHV0UGFyc2VyOiB1c2VyUGFyc2VyXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgbWlkZGxld2FyZSAodXNlck1pZGRsZXdhcmUpIHtcbiAgICAgICAgICAgIHJldHVybiBpbnRlcm5hbENyZWF0ZUJ1aWxkZXIoe1xuICAgICAgICAgICAgICAgIC4uLl9kZWYsXG4gICAgICAgICAgICAgICAgbWlkZGxld2FyZTogdXNlck1pZGRsZXdhcmVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICBvblVwbG9hZENvbXBsZXRlICh1c2VyVXBsb2FkQ29tcGxldGUpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgX2RlZixcbiAgICAgICAgICAgICAgICByZXNvbHZlcjogdXNlclVwbG9hZENvbXBsZXRlXG4gICAgICAgICAgICB9O1xuICAgICAgICB9LFxuICAgICAgICBvblVwbG9hZEVycm9yICh1c2VyT25VcGxvYWRFcnJvcikge1xuICAgICAgICAgICAgcmV0dXJuIGludGVybmFsQ3JlYXRlQnVpbGRlcih7XG4gICAgICAgICAgICAgICAgLi4uX2RlZixcbiAgICAgICAgICAgICAgICBvblVwbG9hZEVycm9yOiB1c2VyT25VcGxvYWRFcnJvclxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xufVxuZnVuY3Rpb24gY3JlYXRlQnVpbGRlcihvcHRzKSB7XG4gICAgcmV0dXJuIChpbnB1dCwgY29uZmlnKT0+e1xuICAgICAgICByZXR1cm4gaW50ZXJuYWxDcmVhdGVCdWlsZGVyKHtcbiAgICAgICAgICAgIHJvdXRlckNvbmZpZzogaW5wdXQsXG4gICAgICAgICAgICByb3V0ZU9wdGlvbnM6IGNvbmZpZyA/PyB7fSxcbiAgICAgICAgICAgIC4uLm9wdHNcbiAgICAgICAgfSk7XG4gICAgfTtcbn1cblxuY29uc3QgY3JlYXRlVXBsb2FkdGhpbmcgPSAob3B0cyk9PmNyZWF0ZUJ1aWxkZXIob3B0cyk7XG5jb25zdCBjcmVhdGVSb3V0ZUhhbmRsZXIgPSAob3B0cyk9PntcbiAgICBjb25zdCBoYW5kbGVyID0gbWFrZUFkYXB0ZXJIYW5kbGVyKChyZXEpPT5FZmZlY3Quc3VjY2VlZCh7XG4gICAgICAgICAgICByZXEsXG4gICAgICAgICAgICByZXM6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGV2ZW50OiB1bmRlZmluZWRcbiAgICAgICAgfSksIChyZXEpPT5FZmZlY3Quc3VjY2VlZChyZXEpLCBvcHRzLCBcIm5leHRqcy1hcHBcIik7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgUE9TVDogaGFuZGxlcixcbiAgICAgICAgR0VUOiBoYW5kbGVyXG4gICAgfTtcbn07XG5cbmV4cG9ydCB7IGNyZWF0ZVJvdXRlSGFuZGxlciwgY3JlYXRlVXBsb2FkdGhpbmcgfTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/uploadthing/next/index.js\n");

/***/ })

};
;